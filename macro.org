
Макросы. Наброски к докладу.

* WTF Macro?

  Наиболее общее определение: Правило или шаблон, определяющий, как
  некую подпоследовательность, поступающую на "вход" следует
  превратить в подпоследовательность на "выходе".

  Таким образом макрос - это отображение. Как правило, выходная
  подпоследовательность больше входной, поэтому процесс отображения
  часто называют "раскрытием", macroexpansion.

  Простейший способ сделать макрос - это перед компиляцией пропустить
  сорцы через препроцессор на регексах, но - это плохой негодный
  способ. Однако рабочий :)

  Почему же он плох? Потому что:
  - Препроцессор работает вне контекста исходника, что ограничивает
    его возможности. Можно конечно накрутить лексер и парсер и дать
    ему этот контекст, но... см. 10-е правило Гринспена.
  - Препроцессор работает со входом и выходом на языке символьных
    подстановок, в то время как эффективнее было бы делать структурные
    подстановки - т.е. заниматься трансформациями AST
  - Препроцессор - это как правило специальный язык (DSL) с
    отличающейся семантикой и синтаксисом. Это вызывает некоторые
    когнитивные сложности у слабых духом иди волей программистов :)
    Кроме того часто отдельные утилитарные куски приходится
    реализовывать как на основном языке так и на языке препроцессора -
    а это как-то некругло - мы же хотим сократить себе работу а не
    увеличивать ее.

** Примеры макросистем позднего голоцена
*** Директива #define (C/C++)

    Закат солнца вручную.

    #+BEGIN_SRC c
      #define MAX(x,y) ((x)>(y))?(x):(y)

      t=MAX(i,s[i]);

      =>

      t=((i)>(s[i])?(i):(s[i]);
    #+END_SRC

*** Макропроцессор m4

    Макроопределения и макровызовы (с параметрами):

    #+BEGIN_EXAMPLE
      define(name [, expansion])

      define('exch', '$2, $1')
      =>
      exch('arg1', 'arg2')
      => arg2, arg1
    #+END_EXAMPLE

    Макросы аналогичны директивам препроцессора #define в C и в то же
    время аналогичны eval. Отличие от #define состоит в том, что для
    #define доступны 3-4 операции (арифметические действия над
    константами, вызов других макросов и две конкатенации).

    Что может m4?
    - Назначение/удаление переменных/макросов (define/undefile)
    - И в стеке тоже (pushdef/popdef)
    - Условное раскрытие (ifdef)
    - Цикл и рекурсия (shift, forloop)
    - Управление 10 виртуальными потоками вывода
    - Вычисление выражений (eval)
    - Операции со строками (substr, len, regexp, patsubst)
    - Подстановка содержимого файлов (include)
    - Выполнение shell-команд (syscmd)
    - Коссвенные вызовы макросов (indir), в т.ч. встроенных (buildin)
    - Трассировка раскрытия (traceon/traceoff)

    Что им можно сделать?
    - Генерация кода из декларативной спецификации
    - Генерация SQL во время компиляции
    - Документирование
    - Администрирование (конфиги)

* Макропроцессор Lisp для чайников

  Макрос в лиспе — это своего рода функция, которая получает в
  качестве аргументов лисповские формы или объекты и, как правило,
  генерирует код, который затем будет скомпилирован и выполнен. Это
  происходит до выполнения программы, во время фазы, которая
  называется развёрткой макросов (macroexpansion). Макросы могут
  выполнять какие-то вычисления во время развёртки, используя полные
  возможности языка.

  Макроопределения и макроподстановки:

  #+BEGIN_SRC lisp
    (defparameter *dbg-enable* t)
    (defparameter *dbg-indent* 1)

    (defun dbgout (out)
      (when *dbg-enable*
        (format t (format nil "~~%~~~AT~~A" *dbg-indent*) out)))

    (defmacro dbg (frmt &rest params)
      `(dbgout (format nil ,frmt ,@params)))

    (macroexpand-1 '(dbg "~A~A~{~A~^,~}" "this is debug message " "15:57:02 " (list 1 2 3 4)))

    => (DBGOUT
        (FORMAT NIL "~A~A~{~A~^,~}" "this is debug message " "15:57:02 "
                (LIST 1 2 3 4))), T

    (dbg "~A~A~{~A~^,~}" "this is debug message " "15:57:02 " (list 1 2 3 4))

    => this is debug message 15:57:02 1,2,3,4
  #+END_SRC

** Преобразование AST макросами

   Если вы облицовываете пол плиткой, размер которой с ноготь, вы не
   тратите излишних усилий – Пол Грэм

   В то время, как в других языках у вас есть небольшие квадратные
   плиточки, в Lisp вы можете выбрать плитку любого размера и любой
   формы.

   Здесь надо добавить какой-нибудь элегантный макрос, который
   выполняет преобразования над AST: Как нам прохавать AST - патчим
   граф выполнения - типичные примеры - профайлинг, логгинг, аспекты.

   Вот тут будет сложно... Это кусок моего проекта по
   автоматизированному поиску работы. Он трансформирует, упрощаяя
   DOM-дерево страницы с вакансиями так, чтобы по нему можно было
   собрать информацию о собственно размещенных вакансиях и компаниях,
   их разместивших.

   Первая функция получает на вход DOM-дерево и функцию
   трансформер-предикат. Если полученное дерево матчится с
   трансформером-предикатом, то возвращается преобразованное дерево, в
   противном случае возвращаем входное дерево "как есть".

   Таким образом можно последовательно прогонять одно и то же
   DOM-дерево не просто через цепочку упрощающих преобразований, а
   через граф с if-ветвлениями.

   Второй макрос - это просто синтаксический сахар, чтобы вызывать
   первую функцию покомпактнее. Содержит гигиену :) Ну а дальше идет
   собственно преобразование - и оно настолько объемное, что я прямо
   не знаю, как я бы справился без этого самонаписанного
   синтаксического сахара... Ну и результат полного макрораскрытия
   смотрится настолько эпично, что у меня даже редактор зависает при
   попытке захайлайтить такую гору кода

   #+BEGIN_SRC lisp
     (in-package #:moto)

     (ql:quickload "split-sequence")

     ;; Это аналог maptree-if, но здесь одна функция и ищет и трансформирует узел дерева
     (defun maptree (predicate-transformer tree)
       (multiple-value-bind (t-tree control)
           (aif (funcall predicate-transformer tree)
                it
                (values tree #'mapcar))
         (if (and (consp t-tree)
                  control)
             (funcall control
                      #'(lambda (x)
                          (maptree predicate-transformer x))
                      t-tree)
             t-tree)))

     ;; maptree-transformer - синтаксический сахар для maptree
     (defmacro mtm (transformer tree)
       (let ((lambda-param (gensym)))
         `(maptree #'(lambda (,lambda-param)
                       (values (match ,lambda-param ,transformer)
                               #'mapcar))
                   ,tree)))


     (print
      (SB-CLTL2:MACROEXPAND-ALL
       '(mtm (`("div" (("class" "search-result") ("data-qa" "vacancy-serp__results")) ,@rest) rest)
         (mtm (`("div" (("data-qa" ,_) ("class" ,(or "search-result-item search-result-item_premium  search-result-item_premium"
                                                     "search-result-item search-result-item_standard "
                                                     "search-result-item search-result-item_standard_plus "))) ,@rest)
               (let ((in (remove-if #'(lambda (x) (or (equal x 'z) (equal x "noindex") (equal x "/noindex"))) rest)))
                 (if (not (equal 1 (length in)))
                     (progn (print in)
                            (err "parsing failed, data printed"))
                     (car in))))
          (mtm (`("a" (("class" _) ("href" _) ("data-qa" "vacancy-serp__vacancy-interview-insider"))
                      "Посмотреть интервью о жизни в компании") 'Z)
           (mtm (`("a" (("href" ,_) ("target" "_blank") ("class" "search-result-item__label search-result-item__label_invited")
                        ("data-qa" "vacancy-serp__vacancy_invited")) "Вы приглашены!") 'Z)
                (mtm (`("a" (("href" ,_) ("target" "_blank") ("class" "search-result-item__label search-result-item__label_discard")
                             ("data-qa" "vacancy-serp__vacancy_rejected")) "Вам отказали") 'Z)
                     (mtm (`("a" (("href" ,_) ("target" "_blank") ("class" "search-result-item__label search-result-item__label_discard")
                                  ("data-qa" "vacancy-serp__vacancy_rejected")) "Вам отказали") 'Z)
                          (mtm (`("a" (("title" "Премия HRBrand") ("href" ,_) ("rel" "nofollow")
                                       ("class" ,_)
                                       ("data-qa" ,_)) " ") 'Z)
                               (mtm (`("div" (("class" "search-result-item__image")) ,_) 'Z)
                                    (mtm (`("script" (("data-name" "HH/VacancyResponseTrigger") ("data-params" ""))) 'Z)
                                         (mtm (`("a" (("href" ,_) ("target" "_blank") ("class" ,_)
                                                      ("data-qa" "vacancy-serp__vacancy_responded")) "Вы откликнулись") 'Z)
                                              (mtm (`("div" (("class" "search-result-item__star")) ,@_) 'Z)
                                                   (mtm (`("div" (("class" "search-result-item__description")) ,@rest)
                                                          (loop :for item :in rest :when (consp item) :append item))
                                                        (mtm (`("div" (("class" "search-result-item__head"))
                                                                      ("a" (("class" ,(or "search-result-item__name search-result-item__name_standard"
                                                                                          "search-result-item__name search-result-item__name_standard_plus"
                                                                                          "search-result-item__name search-result-item__name_premium"))
                                                                            ("data-qa" "vacancy-serp__vacancy-title") ("href" ,id) ("target" "_blank")) ,name))
                                                               (list :id (parse-integer (car (last (split-sequence:split-sequence #\/ id)))) :name name))
                                                             (mtm (`("a" (("class" "interview-insider__link                   m-interview-insider__link-searchresult")
                                                                          ("href" ,href)
                                                                          ("data-qa" "vacancy-serp__vacancy-interview-insider"))
                                                                         "Посмотреть интервью о жизни в компании")
                                                                    (list :interview href))
                                                                  (mtm (`("div" (("class" "b-vacancy-list-salary") ("data-qa" "vacancy-serp__vacancy-compensation"))
                                                                                ("meta" (("itemprop" "salaryCurrency") ("content" ,currency)))
                                                                                ("meta" (("itemprop" "baseSalary") ("content" ,salary))) ,salary-text)
                                                                         (list :currency currency :salary (parse-integer salary) :salary-text salary-text))
                                                                       (mtm (`("div" (("class" "search-result-item__company")) ,emp-name)
                                                                              (list :emp-name emp-name))
                                                                            (mtm (`("div" (("class" "search-result-item__company"))
                                                                                          ("a" (("href" ,emp-id)
                                                                                                ("class" "search-result-item__company-link")
                                                                                                ("data-qa" "vacancy-serp__vacancy-employer"))
                                                                                               ,emp-name))
                                                                                   (list :emp-id (parse-integer (car (last (split-sequence:split-sequence #\/ emp-id)))
                                                                                                                :junk-allowed t)
                                                                                         :emp-name emp-name))
                                                                                 (mtm (`("div" (("class" "search-result-item__info")) ,@rest)
                                                                                        (loop :for item :in rest :when (consp item) :append item))
                                                                                      (mtm (`("span" (("class" "searchresult__address")
                                                                                                      ("data-qa" "vacancy-serp__vacancy-address")) ,city ,@rest)
                                                                                             (let ((metro (loop :for item in rest :do
                                                                                                             (when (and (consp item) (equal :metro (car item)))
                                                                                                               (return (cadr item))))))
                                                                                               (list :city city :metro metro)))
                                                                                           (mtm (`("span" (("class" "metro-station"))
                                                                                                          ("span" (("class" "metro-point") ("style" ,_))) ,metro)
                                                                                                  (list :metro metro))
                                                                                                (mtm (`("span" (("class" "b-vacancy-list-date")
                                                                                                                ("data-qa" "vacancy-serp__vacancy-date")) ,date)
                                                                                                       (list :date date))
                                                                                                     (mtm (`("span"
                                                                                                             (("class" "vacancy-list-platform")
                                                                                                              ("data-qa" "vacancy-serp__vacancy_career"))
                                                                                                             "  •  " ("span" (("class" "vacancy-list-platform__name"))
                                                                                                                             "CAREER.RU"))
                                                                                                            (list :platform 'career.ru))
                                                                                                          (block subtree-extract
                                                                                                            (mtm (`("div"
                                                                                                                    (("class" "search-result")
                                                                                                                     ("data-qa" "vacancy-serp__results"))
                                                                                                                    ,@rest)
                                                                                                                   (return-from subtree-extract rest))
                                                                                                                 ""))))))))))))))))))))))))))

     =>

     (MAPTREE
      #'(LAMBDA (#:G1224)
          (VALUES
           (BLOCK #:BLOCK1254
             (TAGBODY
                (RETURN-FROM #:BLOCK1254
                  (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1255)))
                    (IF (CONSP #:G1224)
                        (LET ((#:G1252 (CAR #:G1224)) (#:G1253 (CDR #:G1224)))
                          (DECLARE (IGNORABLE #:G1252 #:G1253))
                          (IF (OPTIMA.CORE:%EQUAL #:G1252 "div")
                              (IF (CONSP #:G1253)
                                  (LET ((#:G1256 (CAR #:G1253))
                                        (#:G1257 (CDR #:G1253)))
                                    (DECLARE (IGNORABLE #:G1256 #:G1257))
                                    (IF (OPTIMA.CORE:%EQUAL #:G1256
                                                            '(("class"
                                                               "search-result")
                                                              ("data-qa"
                                                               "vacancy-serp__results")))
                                        (LET ((REST #:G1257))
                                          REST)
                                        (GO #:FAIL1255)))
                                  (GO #:FAIL1255))
                              (GO #:FAIL1255)))
                        (GO #:FAIL1255))))
                #:FAIL1255
                (RETURN-FROM #:BLOCK1254 NIL)))
           #'MAPCAR))
      (MAPTREE
       #'(LAMBDA (#:G1258)
           (VALUES
            (BLOCK #:BLOCK1261
              (TAGBODY
                 (RETURN-FROM #:BLOCK1261
                   (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1262)))
                     (IF (CONSP #:G1258)
                         (LET ((#:G1259 (CAR #:G1258)) (#:G1260 (CDR #:G1258)))
                           (DECLARE (IGNORABLE #:G1259 #:G1260))
                           (IF (OPTIMA.CORE:%EQUAL #:G1259 "div")
                               (IF (CONSP #:G1260)
                                   (LET ((#:G1263 (CAR #:G1260))
                                         (#:G1264 (CDR #:G1260)))
                                     (DECLARE (IGNORABLE #:G1263 #:G1264))
                                     (IF (CONSP #:G1263)
                                         (LET ((#:G1267 (CAR #:G1263))
                                               (#:G1268 (CDR #:G1263)))
                                           (DECLARE (IGNORABLE #:G1267 #:G1268))
                                           (IF (CONSP #:G1267)
                                               (LET ((#:G1271 (CAR #:G1267))
                                                     (#:G1272 (CDR #:G1267)))
                                                 (DECLARE
                                                  (IGNORABLE #:G1271 #:G1272))
                                                 (IF (OPTIMA.CORE:%EQUAL #:G1271
                                                                         "data-qa")
                                                     (IF (CONSP #:G1272)
                                                         (LET ((#:G1273
                                                                (CAR #:G1272))
                                                               (#:G1274
                                                                (CDR #:G1272)))
                                                           (DECLARE
                                                            (IGNORABLE #:G1273
                                                                       #:G1274))
                                                           (IF (NULL #:G1274)
                                                               (IF (CONSP #:G1268)
                                                                   (LET ((#:G1275
                                                                          (CAR
                                                                           #:G1268))
                                                                         (#:G1276
                                                                          (CDR
                                                                           #:G1268)))
                                                                     (DECLARE
                                                                      (IGNORABLE
                                                                       #:G1275
                                                                       #:G1276))
                                                                     (IF (CONSP
                                                                          #:G1275)
                                                                         (LET ((#:G1279
                                                                                (CAR
                                                                                 #:G1275))
                                                                               (#:G1280
                                                                                (CDR
                                                                                 #:G1275)))
                                                                           (DECLARE
                                                                            (IGNORABLE
                                                                             #:G1279
                                                                             #:G1280))
                                                                           (IF (OPTIMA.CORE:%EQUAL
                                                                                #:G1279
                                                                                "class")
                                                                               (IF (CONSP
                                                                                    #:G1280)
                                                                                   (LET ((#:G1281
                                                                                          (CAR
                                                                                           #:G1280))
                                                                                         (#:G1282
                                                                                          (CDR
                                                                                           #:G1280)))
                                                                                     (DECLARE
                                                                                      (IGNORABLE
                                                                                       #:G1281
                                                                                       #:G1282))
                                                                                     (PROGN
                                                                                       (BLOCK
                                                                                           #:BLOCK1283
                                                                                         (TAGBODY
                                                                                            (RETURN-FROM
                                                                                             #:BLOCK1283
                                                                                              (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                                                                                 (GO
                                                                                                                  #:FAIL1284)))
                                                                                                (IF (OPTIMA.CORE:%EQUAL
                                                                                                     #:G1281
                                                                                                     "search-result-item search-result-item_premium  search-result-item_premium")
                                                                                                    (VALUES)
                                                                                                    (GO
                                                                                                     #:FAIL1284))))
                                                                                            #:FAIL1284
                                                                                            (RETURN-FROM
                                                                                             #:BLOCK1283
                                                                                              (BLOCK
                                                                                                  #:BLOCK1285
                                                                                                (TAGBODY
                                                                                                   (RETURN-FROM
                                                                                                    #:BLOCK1285
                                                                                                     (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                                                                                        (GO
                                                                                                                         #:FAIL1286)))
                                                                                                       (IF (OPTIMA.CORE:%EQUAL
                                                                                                            #:G1281
                                                                                                            "search-result-item search-result-item_standard ")
                                                                                                           (VALUES)
                                                                                                           (GO
                                                                                                            #:FAIL1286))))
                                                                                                   #:FAIL1286
                                                                                                   (RETURN-FROM
                                                                                                    #:BLOCK1285
                                                                                                     (IF (OPTIMA.CORE:%EQUAL
                                                                                                          #:G1281
                                                                                                          "search-result-item search-result-item_standard_plus ")
                                                                                                         (VALUES)
                                                                                                         (GO
                                                                                                          #:FAIL1262))))))))
                                                                                       (IF (NULL
                                                                                            #:G1282)
                                                                                           (IF (NULL
                                                                                                #:G1276)
                                                                                               (LET ((REST
                                                                                                      #:G1264))
                                                                                                 (LET ((IN
                                                                                                        (REMOVE-IF
                                                                                                         #'(LAMBDA
                                                                                                               (X)
                                                                                                             (LET ((#:G1288
                                                                                                                    (EQUAL
                                                                                                                     X
                                                                                                                     'Z)))
                                                                                                               (IF #:G1288
                                                                                                                   #:G1288
                                                                                                                   (LET ((#:G1289
                                                                                                                          (EQUAL
                                                                                                                           X
                                                                                                                           "noindex")))
                                                                                                                     (IF #:G1289
                                                                                                                         #:G1289
                                                                                                                         (THE
                                                                                                                          T
                                                                                                                          (EQUAL
                                                                                                                           X
                                                                                                                           "/noindex")))))))
                                                                                                         REST)))
                                                                                                   (IF (NOT
                                                                                                        (EQUAL
                                                                                                         1
                                                                                                         (LENGTH
                                                                                                          IN)))
                                                                                                       (PROGN
                                                                                                         (PRINT
                                                                                                          IN)
                                                                                                         (ERROR
                                                                                                          (FORMAT
                                                                                                           NIL
                                                                                                           "ERR:[~A]"
                                                                                                           (SUBSEQ
                                                                                                            (LET ((*STANDARD-OUTPUT*
                                                                                                                   (MAKE-STRING-OUTPUT-STREAM)))
                                                                                                              (UNWIND-PROTECT
                                                                                                                   (PROGN
                                                                                                                     (PPRINT
                                                                                                                      "parsing failed, data printed"))
                                                                                                                (CLOSE
                                                                                                                 ,*STANDARD-OUTPUT*))
                                                                                                              (GET-OUTPUT-STREAM-STRING
                                                                                                               ,*STANDARD-OUTPUT*))
                                                                                                            1))))
                                                                                                       (CAR
                                                                                                        IN))))
                                                                                               (GO
                                                                                                #:FAIL1262))
                                                                                           (GO
                                                                                            #:FAIL1262))))
                                                                                   (GO
                                                                                    #:FAIL1262))
                                                                               (GO
                                                                                #:FAIL1262)))
                                                                         (GO
                                                                          #:FAIL1262)))
                                                                   (GO #:FAIL1262))
                                                               (GO #:FAIL1262)))
                                                         (GO #:FAIL1262))
                                                     (GO #:FAIL1262)))
                                               (GO #:FAIL1262)))
                                         (GO #:FAIL1262)))
                                   (GO #:FAIL1262))
                               (GO #:FAIL1262)))
                         (GO #:FAIL1262))))
                 #:FAIL1262
                 (RETURN-FROM #:BLOCK1261 NIL)))
            #'MAPCAR))
       (MAPTREE
        #'(LAMBDA (#:G1290)
            (VALUES
             (BLOCK #:BLOCK1291
               (TAGBODY
                  (RETURN-FROM #:BLOCK1291
                    (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1292)))
                      (IF (OPTIMA.CORE:%EQUAL #:G1290
                                              '("a"
                                                (("class" _) ("href" _)
                                                 ("data-qa"
                                                  "vacancy-serp__vacancy-interview-insider"))
                                                "Посмотреть интервью о жизни в компании"))
                          'Z
                          (GO #:FAIL1292))))
                  #:FAIL1292
                  (RETURN-FROM #:BLOCK1291 NIL)))
             #'MAPCAR))
        (MAPTREE
         #'(LAMBDA (#:G1293)
             (VALUES
              (BLOCK #:BLOCK1296
                (TAGBODY
                   (RETURN-FROM #:BLOCK1296
                     (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1297)))
                       (IF (CONSP #:G1293)
                           (LET ((#:G1294 (CAR #:G1293)) (#:G1295 (CDR #:G1293)))
                             (DECLARE (IGNORABLE #:G1294 #:G1295))
                             (IF (OPTIMA.CORE:%EQUAL #:G1294 "a")
                                 (IF (CONSP #:G1295)
                                     (LET ((#:G1298 (CAR #:G1295))
                                           (#:G1299 (CDR #:G1295)))
                                       (DECLARE (IGNORABLE #:G1298 #:G1299))
                                       (IF (CONSP #:G1298)
                                           (LET ((#:G1302 (CAR #:G1298))
                                                 (#:G1303 (CDR #:G1298)))
                                             (DECLARE (IGNORABLE #:G1302 #:G1303))
                                             (IF (CONSP #:G1302)
                                                 (LET ((#:G1306 (CAR #:G1302))
                                                       (#:G1307 (CDR #:G1302)))
                                                   (DECLARE
                                                    (IGNORABLE #:G1306 #:G1307))
                                                   (IF (OPTIMA.CORE:%EQUAL #:G1306
                                                                           "href")
                                                       (IF (CONSP #:G1307)
                                                           (LET ((#:G1308
                                                                  (CAR #:G1307))
                                                                 (#:G1309
                                                                  (CDR #:G1307)))
                                                             (DECLARE
                                                              (IGNORABLE #:G1308
                                                                         #:G1309))
                                                             (IF (NULL #:G1309)
                                                                 (IF (OPTIMA.CORE:%EQUAL
                                                                      #:G1303
                                                                      '(("target"
                                                                         "_blank")
                                                                        ("class"
                                                                         "search-result-item__label search-result-item__label_invited")
                                                                        ("data-qa"
                                                                         "vacancy-serp__vacancy_invited")))
                                                                     (IF (OPTIMA.CORE:%EQUAL
                                                                          #:G1299
                                                                          '("Вы приглашены!"))
                                                                         'Z
                                                                         (GO
                                                                          #:FAIL1297))
                                                                     (GO #:FAIL1297))
                                                                 (GO #:FAIL1297)))
                                                           (GO #:FAIL1297))
                                                       (GO #:FAIL1297)))
                                                 (GO #:FAIL1297)))
                                           (GO #:FAIL1297)))
                                     (GO #:FAIL1297))
                                 (GO #:FAIL1297)))
                           (GO #:FAIL1297))))
                   #:FAIL1297
                   (RETURN-FROM #:BLOCK1296 NIL)))
              #'MAPCAR))
         (MAPTREE
          #'(LAMBDA (#:G1310)
              (VALUES
               (BLOCK #:BLOCK1313
                 (TAGBODY
                    (RETURN-FROM #:BLOCK1313
                      (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1314)))
                        (IF (CONSP #:G1310)
                            (LET ((#:G1311 (CAR #:G1310)) (#:G1312 (CDR #:G1310)))
                              (DECLARE (IGNORABLE #:G1311 #:G1312))
                              (IF (OPTIMA.CORE:%EQUAL #:G1311 "a")
                                  (IF (CONSP #:G1312)
                                      (LET ((#:G1315 (CAR #:G1312))
                                            (#:G1316 (CDR #:G1312)))
                                        (DECLARE (IGNORABLE #:G1315 #:G1316))
                                        (IF (CONSP #:G1315)
                                            (LET ((#:G1319 (CAR #:G1315))
                                                  (#:G1320 (CDR #:G1315)))
                                              (DECLARE (IGNORABLE #:G1319 #:G1320))
                                              (IF (CONSP #:G1319)
                                                  (LET ((#:G1323 (CAR #:G1319))
                                                        (#:G1324 (CDR #:G1319)))
                                                    (DECLARE
                                                     (IGNORABLE #:G1323 #:G1324))
                                                    (IF (OPTIMA.CORE:%EQUAL #:G1323
                                                                            "href")
                                                        (IF (CONSP #:G1324)
                                                            (LET ((#:G1325
                                                                   (CAR #:G1324))
                                                                  (#:G1326
                                                                   (CDR #:G1324)))
                                                              (DECLARE
                                                               (IGNORABLE #:G1325
                                                                          #:G1326))
                                                              (IF (NULL #:G1326)
                                                                  (IF (OPTIMA.CORE:%EQUAL
                                                                       #:G1320
                                                                       '(("target"
                                                                          "_blank")
                                                                         ("class"
                                                                          "search-result-item__label search-result-item__label_discard")
                                                                         ("data-qa"
                                                                          "vacancy-serp__vacancy_rejected")))
                                                                      (IF (OPTIMA.CORE:%EQUAL
                                                                           #:G1316
                                                                           '("Вам отказали"))
                                                                          'Z
                                                                          (GO
                                                                           #:FAIL1314))
                                                                      (GO
                                                                       #:FAIL1314))
                                                                  (GO #:FAIL1314)))
                                                            (GO #:FAIL1314))
                                                        (GO #:FAIL1314)))
                                                  (GO #:FAIL1314)))
                                            (GO #:FAIL1314)))
                                      (GO #:FAIL1314))
                                  (GO #:FAIL1314)))
                            (GO #:FAIL1314))))
                    #:FAIL1314
                    (RETURN-FROM #:BLOCK1313 NIL)))
               #'MAPCAR))
          (MAPTREE
           #'(LAMBDA (#:G1327)
               (VALUES
                (BLOCK #:BLOCK1330
                  (TAGBODY
                     (RETURN-FROM #:BLOCK1330
                       (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1331)))
                         (IF (CONSP #:G1327)
                             (LET ((#:G1328 (CAR #:G1327)) (#:G1329 (CDR #:G1327)))
                               (DECLARE (IGNORABLE #:G1328 #:G1329))
                               (IF (OPTIMA.CORE:%EQUAL #:G1328 "a")
                                   (IF (CONSP #:G1329)
                                       (LET ((#:G1332 (CAR #:G1329))
                                             (#:G1333 (CDR #:G1329)))
                                         (DECLARE (IGNORABLE #:G1332 #:G1333))
                                         (IF (CONSP #:G1332)
                                             (LET ((#:G1336 (CAR #:G1332))
                                                   (#:G1337 (CDR #:G1332)))
                                               (DECLARE (IGNORABLE #:G1336 #:G1337))
                                               (IF (CONSP #:G1336)
                                                   (LET ((#:G1340 (CAR #:G1336))
                                                         (#:G1341 (CDR #:G1336)))
                                                     (DECLARE
                                                      (IGNORABLE #:G1340 #:G1341))
                                                     (IF (OPTIMA.CORE:%EQUAL #:G1340
                                                                             "href")
                                                         (IF (CONSP #:G1341)
                                                             (LET ((#:G1342
                                                                    (CAR #:G1341))
                                                                   (#:G1343
                                                                    (CDR #:G1341)))
                                                               (DECLARE
                                                                (IGNORABLE #:G1342
                                                                           #:G1343))
                                                               (IF (NULL #:G1343)
                                                                   (IF (OPTIMA.CORE:%EQUAL
                                                                        #:G1337
                                                                        '(("target"
                                                                           "_blank")
                                                                          ("class"
                                                                           "search-result-item__label search-result-item__label_discard")
                                                                          ("data-qa"
                                                                           "vacancy-serp__vacancy_rejected")))
                                                                       (IF (OPTIMA.CORE:%EQUAL
                                                                            #:G1333
                                                                            '("Вам отказали"))
                                                                           'Z
                                                                           (GO
                                                                            #:FAIL1331))
                                                                       (GO
                                                                        #:FAIL1331))
                                                                   (GO #:FAIL1331)))
                                                             (GO #:FAIL1331))
                                                         (GO #:FAIL1331)))
                                                   (GO #:FAIL1331)))
                                             (GO #:FAIL1331)))
                                       (GO #:FAIL1331))
                                   (GO #:FAIL1331)))
                             (GO #:FAIL1331))))
                     #:FAIL1331
                     (RETURN-FROM #:BLOCK1330 NIL)))
                #'MAPCAR))
           (MAPTREE
            #'(LAMBDA (#:G1344)
                (VALUES
                 (BLOCK #:BLOCK1347
                   (TAGBODY
                      (RETURN-FROM #:BLOCK1347
                        (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1348)))
                          (IF (CONSP #:G1344)
                              (LET ((#:G1345 (CAR #:G1344)) (#:G1346 (CDR #:G1344)))
                                (DECLARE (IGNORABLE #:G1345 #:G1346))
                                (IF (OPTIMA.CORE:%EQUAL #:G1345 "a")
                                    (IF (CONSP #:G1346)
                                        (LET ((#:G1349 (CAR #:G1346))
                                              (#:G1350 (CDR #:G1346)))
                                          (DECLARE (IGNORABLE #:G1349 #:G1350))
                                          (IF (CONSP #:G1349)
                                              (LET ((#:G1353 (CAR #:G1349))
                                                    (#:G1354 (CDR #:G1349)))
                                                (DECLARE (IGNORABLE #:G1353 #:G1354))
                                                (IF (OPTIMA.CORE:%EQUAL #:G1353
                                                                        '("title"
                                                                          "Премия HRBrand"))
                                                    (IF (CONSP #:G1354)
                                                        (LET ((#:G1355 (CAR #:G1354))
                                                              (#:G1356 (CDR #:G1354)))
                                                          (DECLARE
                                                           (IGNORABLE #:G1355
                                                                      #:G1356))
                                                          (IF (CONSP #:G1355)
                                                              (LET ((#:G1359
                                                                     (CAR #:G1355))
                                                                    (#:G1360
                                                                     (CDR #:G1355)))
                                                                (DECLARE
                                                                 (IGNORABLE #:G1359
                                                                            #:G1360))
                                                                (IF (OPTIMA.CORE:%EQUAL
                                                                     #:G1359 "href")
                                                                    (IF (CONSP
                                                                         #:G1360)
                                                                        (LET ((#:G1361
                                                                               (CAR
                                                                                #:G1360))
                                                                              (#:G1362
                                                                               (CDR
                                                                                #:G1360)))
                                                                          (DECLARE
                                                                           (IGNORABLE
                                                                            #:G1361
                                                                            #:G1362))
                                                                          (IF (NULL
                                                                               #:G1362)
                                                                              (IF (CONSP
                                                                                   #:G1356)
                                                                                  (LET ((#:G1363
                                                                                         (CAR
                                                                                          #:G1356))
                                                                                        (#:G1364
                                                                                         (CDR
                                                                                          #:G1356)))
                                                                                    (DECLARE
                                                                                     (IGNORABLE
                                                                                      #:G1363
                                                                                      #:G1364))
                                                                                    (IF (OPTIMA.CORE:%EQUAL
                                                                                         #:G1363
                                                                                         '("rel"
                                                                                           "nofollow"))
                                                                                        (IF (CONSP
                                                                                             #:G1364)
                                                                                            (LET ((#:G1365
                                                                                                   (CAR
                                                                                                    #:G1364))
                                                                                                  (#:G1366
                                                                                                   (CDR
                                                                                                    #:G1364)))
                                                                                              (DECLARE
                                                                                               (IGNORABLE
                                                                                                #:G1365
                                                                                                #:G1366))
                                                                                              (IF (CONSP
                                                                                                   #:G1365)
                                                                                                  (LET ((#:G1369
                                                                                                         (CAR
                                                                                                          #:G1365))
                                                                                                        (#:G1370
                                                                                                         (CDR
                                                                                                          #:G1365)))
                                                                                                    (DECLARE
                                                                                                     (IGNORABLE
                                                                                                      #:G1369
                                                                                                      #:G1370))
                                                                                                    (IF (OPTIMA.CORE:%EQUAL
                                                                                                         #:G1369
                                                                                                         "class")
                                                                                                        (IF (CONSP
                                                                                                             #:G1370)
                                                                                                            (LET ((#:G1371
                                                                                                                   (CAR
                                                                                                                    #:G1370))
                                                                                                                  (#:G1372
                                                                                                                   (CDR
                                                                                                                    #:G1370)))
                                                                                                              (DECLARE
                                                                                                               (IGNORABLE
                                                                                                                #:G1371
                                                                                                                #:G1372))
                                                                                                              (IF (NULL
                                                                                                                   #:G1372)
                                                                                                                  (IF (CONSP
                                                                                                                       #:G1366)
                                                                                                                      (LET ((#:G1373
                                                                                                                             (CAR
                                                                                                                              #:G1366))
                                                                                                                            (#:G1374
                                                                                                                             (CDR
                                                                                                                              #:G1366)))
                                                                                                                        (DECLARE
                                                                                                                         (IGNORABLE
                                                                                                                          #:G1373
                                                                                                                          #:G1374))
                                                                                                                        (IF (CONSP
                                                                                                                             #:G1373)
                                                                                                                            (LET ((#:G1377
                                                                                                                                   (CAR
                                                                                                                                    #:G1373))
                                                                                                                                  (#:G1378
                                                                                                                                   (CDR
                                                                                                                                    #:G1373)))
                                                                                                                              (DECLARE
                                                                                                                               (IGNORABLE
                                                                                                                                #:G1377
                                                                                                                                #:G1378))
                                                                                                                              (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                   #:G1377
                                                                                                                                   "data-qa")
                                                                                                                                  (IF (CONSP
                                                                                                                                       #:G1378)
                                                                                                                                      (LET ((#:G1379
                                                                                                                                             (CAR
                                                                                                                                              #:G1378))
                                                                                                                                            (#:G1380
                                                                                                                                             (CDR
                                                                                                                                              #:G1378)))
                                                                                                                                        (DECLARE
                                                                                                                                         (IGNORABLE
                                                                                                                                          #:G1379
                                                                                                                                          #:G1380))
                                                                                                                                        (IF (NULL
                                                                                                                                             #:G1380)
                                                                                                                                            (IF (NULL
                                                                                                                                                 #:G1374)
                                                                                                                                                (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                                     #:G1350
                                                                                                                                                     '(" "))
                                                                                                                                                    'Z
                                                                                                                                                    (GO
                                                                                                                                                     #:FAIL1348))
                                                                                                                                                (GO
                                                                                                                                                 #:FAIL1348))
                                                                                                                                            (GO
                                                                                                                                             #:FAIL1348)))
                                                                                                                                      (GO
                                                                                                                                       #:FAIL1348))
                                                                                                                                  (GO
                                                                                                                                   #:FAIL1348)))
                                                                                                                            (GO
                                                                                                                             #:FAIL1348)))
                                                                                                                      (GO
                                                                                                                       #:FAIL1348))
                                                                                                                  (GO
                                                                                                                   #:FAIL1348)))
                                                                                                            (GO
                                                                                                             #:FAIL1348))
                                                                                                        (GO
                                                                                                         #:FAIL1348)))
                                                                                                  (GO
                                                                                                   #:FAIL1348)))
                                                                                            (GO
                                                                                             #:FAIL1348))
                                                                                        (GO
                                                                                         #:FAIL1348)))
                                                                                  (GO
                                                                                   #:FAIL1348))
                                                                              (GO
                                                                               #:FAIL1348)))
                                                                        (GO
                                                                         #:FAIL1348))
                                                                    (GO #:FAIL1348)))
                                                              (GO #:FAIL1348)))
                                                        (GO #:FAIL1348))
                                                    (GO #:FAIL1348)))
                                              (GO #:FAIL1348)))
                                        (GO #:FAIL1348))
                                    (GO #:FAIL1348)))
                              (GO #:FAIL1348))))
                      #:FAIL1348
                      (RETURN-FROM #:BLOCK1347 NIL)))
                 #'MAPCAR))
            (MAPTREE
             #'(LAMBDA (#:G1381)
                 (VALUES
                  (BLOCK #:BLOCK1384
                    (TAGBODY
                       (RETURN-FROM #:BLOCK1384
                         (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1385)))
                           (IF (CONSP #:G1381)
                               (LET ((#:G1382 (CAR #:G1381)) (#:G1383 (CDR #:G1381)))
                                 (DECLARE (IGNORABLE #:G1382 #:G1383))
                                 (IF (OPTIMA.CORE:%EQUAL #:G1382 "div")
                                     (IF (CONSP #:G1383)
                                         (LET ((#:G1386 (CAR #:G1383))
                                               (#:G1387 (CDR #:G1383)))
                                           (DECLARE (IGNORABLE #:G1386 #:G1387))
                                           (IF (OPTIMA.CORE:%EQUAL #:G1386
                                                                   '(("class"
                                                                      "search-result-item__image")))
                                               (IF (CONSP #:G1387)
                                                   (LET ((#:G1388 (CAR #:G1387))
                                                         (#:G1389 (CDR #:G1387)))
                                                     (DECLARE
                                                      (IGNORABLE #:G1388 #:G1389))
                                                     (IF (NULL #:G1389)
                                                         'Z
                                                         (GO #:FAIL1385)))
                                                   (GO #:FAIL1385))
                                               (GO #:FAIL1385)))
                                         (GO #:FAIL1385))
                                     (GO #:FAIL1385)))
                               (GO #:FAIL1385))))
                       #:FAIL1385
                       (RETURN-FROM #:BLOCK1384 NIL)))
                  #'MAPCAR))
             (MAPTREE
              #'(LAMBDA (#:G1390)
                  (VALUES
                   (BLOCK #:BLOCK1391
                     (TAGBODY
                        (RETURN-FROM #:BLOCK1391
                          (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1392)))
                            (IF (OPTIMA.CORE:%EQUAL #:G1390
                                                    '("script"
                                                      (("data-name"
                                                        "HH/VacancyResponseTrigger")
                                                       ("data-params" ""))))
                                'Z
                                (GO #:FAIL1392))))
                        #:FAIL1392
                        (RETURN-FROM #:BLOCK1391 NIL)))
                   #'MAPCAR))
              (MAPTREE
               #'(LAMBDA (#:G1393)
                   (VALUES
                    (BLOCK #:BLOCK1396
                      (TAGBODY
                         (RETURN-FROM #:BLOCK1396
                           (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1397)))
                             (IF (CONSP #:G1393)
                                 (LET ((#:G1394 (CAR #:G1393))
                                       (#:G1395 (CDR #:G1393)))
                                   (DECLARE (IGNORABLE #:G1394 #:G1395))
                                   (IF (OPTIMA.CORE:%EQUAL #:G1394 "a")
                                       (IF (CONSP #:G1395)
                                           (LET ((#:G1398 (CAR #:G1395))
                                                 (#:G1399 (CDR #:G1395)))
                                             (DECLARE (IGNORABLE #:G1398 #:G1399))
                                             (IF (CONSP #:G1398)
                                                 (LET ((#:G1402 (CAR #:G1398))
                                                       (#:G1403 (CDR #:G1398)))
                                                   (DECLARE
                                                    (IGNORABLE #:G1402 #:G1403))
                                                   (IF (CONSP #:G1402)
                                                       (LET ((#:G1406 (CAR #:G1402))
                                                             (#:G1407 (CDR #:G1402)))
                                                         (DECLARE
                                                          (IGNORABLE #:G1406
                                                                     #:G1407))
                                                         (IF (OPTIMA.CORE:%EQUAL
                                                              #:G1406 "href")
                                                             (IF (CONSP #:G1407)
                                                                 (LET ((#:G1408
                                                                        (CAR
                                                                         #:G1407))
                                                                       (#:G1409
                                                                        (CDR
                                                                         #:G1407)))
                                                                   (DECLARE
                                                                    (IGNORABLE
                                                                     #:G1408
                                                                     #:G1409))
                                                                   (IF (NULL #:G1409)
                                                                       (IF (CONSP
                                                                            #:G1403)
                                                                           (LET ((#:G1410
                                                                                  (CAR
                                                                                   #:G1403))
                                                                                 (#:G1411
                                                                                  (CDR
                                                                                   #:G1403)))
                                                                             (DECLARE
                                                                              (IGNORABLE
                                                                               #:G1410
                                                                               #:G1411))
                                                                             (IF (OPTIMA.CORE:%EQUAL
                                                                                  #:G1410
                                                                                  '("target"
                                                                                    "_blank"))
                                                                                 (IF (CONSP
                                                                                      #:G1411)
                                                                                     (LET ((#:G1412
                                                                                            (CAR
                                                                                             #:G1411))
                                                                                           (#:G1413
                                                                                            (CDR
                                                                                             #:G1411)))
                                                                                       (DECLARE
                                                                                        (IGNORABLE
                                                                                         #:G1412
                                                                                         #:G1413))
                                                                                       (IF (CONSP
                                                                                            #:G1412)
                                                                                           (LET ((#:G1416
                                                                                                  (CAR
                                                                                                   #:G1412))
                                                                                                 (#:G1417
                                                                                                  (CDR
                                                                                                   #:G1412)))
                                                                                             (DECLARE
                                                                                              (IGNORABLE
                                                                                               #:G1416
                                                                                               #:G1417))
                                                                                             (IF (OPTIMA.CORE:%EQUAL
                                                                                                  #:G1416
                                                                                                  "class")
                                                                                                 (IF (CONSP
                                                                                                      #:G1417)
                                                                                                     (LET ((#:G1418
                                                                                                            (CAR
                                                                                                             #:G1417))
                                                                                                           (#:G1419
                                                                                                            (CDR
                                                                                                             #:G1417)))
                                                                                                       (DECLARE
                                                                                                        (IGNORABLE
                                                                                                         #:G1418
                                                                                                         #:G1419))
                                                                                                       (IF (NULL
                                                                                                            #:G1419)
                                                                                                           (IF (OPTIMA.CORE:%EQUAL
                                                                                                                #:G1413
                                                                                                                '(("data-qa"
                                                                                                                   "vacancy-serp__vacancy_responded")))
                                                                                                               (IF (OPTIMA.CORE:%EQUAL
                                                                                                                    #:G1399
                                                                                                                    '("Вы откликнулись"))
                                                                                                                   'Z
                                                                                                                   (GO
                                                                                                                    #:FAIL1397))
                                                                                                               (GO
                                                                                                                #:FAIL1397))
                                                                                                           (GO
                                                                                                            #:FAIL1397)))
                                                                                                     (GO
                                                                                                      #:FAIL1397))
                                                                                                 (GO
                                                                                                  #:FAIL1397)))
                                                                                           (GO
                                                                                            #:FAIL1397)))
                                                                                     (GO
                                                                                      #:FAIL1397))
                                                                                 (GO
                                                                                  #:FAIL1397)))
                                                                           (GO
                                                                            #:FAIL1397))
                                                                       (GO
                                                                        #:FAIL1397)))
                                                                 (GO #:FAIL1397))
                                                             (GO #:FAIL1397)))
                                                       (GO #:FAIL1397)))
                                                 (GO #:FAIL1397)))
                                           (GO #:FAIL1397))
                                       (GO #:FAIL1397)))
                                 (GO #:FAIL1397))))
                         #:FAIL1397
                         (RETURN-FROM #:BLOCK1396 NIL)))
                    #'MAPCAR))
               (MAPTREE
                #'(LAMBDA (#:G1420)
                    (VALUES
                     (BLOCK #:BLOCK1423
                       (TAGBODY
                          (RETURN-FROM #:BLOCK1423
                            (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1424)))
                              (IF (CONSP #:G1420)
                                  (LET ((#:G1421 (CAR #:G1420))
                                        (#:G1422 (CDR #:G1420)))
                                    (DECLARE (IGNORABLE #:G1421 #:G1422))
                                    (IF (OPTIMA.CORE:%EQUAL #:G1421 "div")
                                        (IF (CONSP #:G1422)
                                            (LET ((#:G1425 (CAR #:G1422))
                                                  (#:G1426 (CDR #:G1422)))
                                              (DECLARE (IGNORABLE #:G1425 #:G1426))
                                              (IF (OPTIMA.CORE:%EQUAL #:G1425
                                                                      '(("class"
                                                                         "search-result-item__star")))
                                                  'Z
                                                  (GO #:FAIL1424)))
                                            (GO #:FAIL1424))
                                        (GO #:FAIL1424)))
                                  (GO #:FAIL1424))))
                          #:FAIL1424
                          (RETURN-FROM #:BLOCK1423 NIL)))
                     #'MAPCAR))
                (MAPTREE
                 #'(LAMBDA (#:G1427)
                     (VALUES
                      (BLOCK #:BLOCK1430
                        (TAGBODY
                           (RETURN-FROM #:BLOCK1430
                             (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1431)))
                               (IF (CONSP #:G1427)
                                   (LET ((#:G1428 (CAR #:G1427))
                                         (#:G1429 (CDR #:G1427)))
                                     (DECLARE (IGNORABLE #:G1428 #:G1429))
                                     (IF (OPTIMA.CORE:%EQUAL #:G1428 "div")
                                         (IF (CONSP #:G1429)
                                             (LET ((#:G1432 (CAR #:G1429))
                                                   (#:G1433 (CDR #:G1429)))
                                               (DECLARE (IGNORABLE #:G1432 #:G1433))
                                               (IF (OPTIMA.CORE:%EQUAL #:G1432
                                                                       '(("class"
                                                                          "search-result-item__description")))
                                                   (LET ((REST #:G1433))
                                                     (BLOCK NIL
                                                       (LET ((ITEM NIL)
                                                             (#:LOOP-LIST-1437 REST))
                                                         (DECLARE
                                                          (TYPE LIST
                                                                #:LOOP-LIST-1437))
                                                         (LET* ((#:LOOP-LIST-HEAD-1438
                                                                 (LIST NIL))
                                                                (#:LOOP-LIST-TAIL-1439
                                                                 #:LOOP-LIST-HEAD-1438))
                                                           (TAGBODY
                                                            SB-LOOP::NEXT-LOOP
                                                              (IF (ENDP
                                                                   #:LOOP-LIST-1437)
                                                                  (PROGN
                                                                    (GO
                                                                     SB-LOOP::END-LOOP))
                                                                  NIL)
                                                              (SETQ ITEM
                                                                    (CAR
                                                                     #:LOOP-LIST-1437))
                                                              (SETQ #:LOOP-LIST-1437
                                                                    (CDR
                                                                     #:LOOP-LIST-1437))
                                                              (IF (CONSP ITEM)
                                                                  (IF (SB-KERNEL:%RPLACD
                                                                       #:LOOP-LIST-TAIL-1439
                                                                       (COPY-LIST
                                                                        ITEM))
                                                                      (PROGN
                                                                        (SETQ #:LOOP-LIST-TAIL-1439
                                                                              (LAST
                                                                               (CDR
                                                                                #:LOOP-LIST-TAIL-1439))))
                                                                      NIL))
                                                              (GO SB-LOOP::NEXT-LOOP)
                                                            SB-LOOP::END-LOOP
                                                              (RETURN-FROM NIL
                                                                (CDR
                                                                 #:LOOP-LIST-HEAD-1438)))))))
                                                   (GO #:FAIL1431)))
                                             (GO #:FAIL1431))
                                         (GO #:FAIL1431)))
                                   (GO #:FAIL1431))))
                           #:FAIL1431
                           (RETURN-FROM #:BLOCK1430 NIL)))
                      #'MAPCAR))
                 (MAPTREE
                  #'(LAMBDA (#:G1442)
                      (VALUES
                       (BLOCK #:BLOCK1445
                         (TAGBODY
                            (RETURN-FROM #:BLOCK1445
                              (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1446)))
                                (IF (CONSP #:G1442)
                                    (LET ((#:G1443 (CAR #:G1442))
                                          (#:G1444 (CDR #:G1442)))
                                      (DECLARE (IGNORABLE #:G1443 #:G1444))
                                      (IF (OPTIMA.CORE:%EQUAL #:G1443 "div")
                                          (IF (CONSP #:G1444)
                                              (LET ((#:G1447 (CAR #:G1444))
                                                    (#:G1448 (CDR #:G1444)))
                                                (DECLARE (IGNORABLE #:G1447 #:G1448))
                                                (IF (OPTIMA.CORE:%EQUAL #:G1447
                                                                        '(("class"
                                                                           "search-result-item__head")))
                                                    (IF (CONSP #:G1448)
                                                        (LET ((#:G1449 (CAR #:G1448))
                                                              (#:G1450 (CDR #:G1448)))
                                                          (DECLARE
                                                           (IGNORABLE #:G1449
                                                                      #:G1450))
                                                          (IF (CONSP #:G1449)
                                                              (LET ((#:G1453
                                                                     (CAR #:G1449))
                                                                    (#:G1454
                                                                     (CDR #:G1449)))
                                                                (DECLARE
                                                                 (IGNORABLE #:G1453
                                                                            #:G1454))
                                                                (IF (OPTIMA.CORE:%EQUAL
                                                                     #:G1453 "a")
                                                                    (IF (CONSP
                                                                         #:G1454)
                                                                        (LET ((#:G1455
                                                                               (CAR
                                                                                #:G1454))
                                                                              (#:G1456
                                                                               (CDR
                                                                                #:G1454)))
                                                                          (DECLARE
                                                                           (IGNORABLE
                                                                            #:G1455
                                                                            #:G1456))
                                                                          (IF (CONSP
                                                                               #:G1455)
                                                                              (LET ((#:G1459
                                                                                     (CAR
                                                                                      #:G1455))
                                                                                    (#:G1460
                                                                                     (CDR
                                                                                      #:G1455)))
                                                                                (DECLARE
                                                                                 (IGNORABLE
                                                                                  #:G1459
                                                                                  #:G1460))
                                                                                (IF (CONSP
                                                                                     #:G1459)
                                                                                    (LET ((#:G1463
                                                                                           (CAR
                                                                                            #:G1459))
                                                                                          (#:G1464
                                                                                           (CDR
                                                                                            #:G1459)))
                                                                                      (DECLARE
                                                                                       (IGNORABLE
                                                                                        #:G1463
                                                                                        #:G1464))
                                                                                      (IF (OPTIMA.CORE:%EQUAL
                                                                                           #:G1463
                                                                                           "class")
                                                                                          (IF (CONSP
                                                                                               #:G1464)
                                                                                              (LET ((#:G1465
                                                                                                     (CAR
                                                                                                      #:G1464))
                                                                                                    (#:G1466
                                                                                                     (CDR
                                                                                                      #:G1464)))
                                                                                                (DECLARE
                                                                                                 (IGNORABLE
                                                                                                  #:G1465
                                                                                                  #:G1466))
                                                                                                (PROGN
                                                                                                  (BLOCK
                                                                                                      #:BLOCK1467
                                                                                                    (TAGBODY
                                                                                                       (RETURN-FROM
                                                                                                        #:BLOCK1467
                                                                                                         (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                                                                                            (GO
                                                                                                                             #:FAIL1468)))
                                                                                                           (IF (OPTIMA.CORE:%EQUAL
                                                                                                                #:G1465
                                                                                                                "search-result-item__name search-result-item__name_standard")
                                                                                                               (VALUES)
                                                                                                               (GO
                                                                                                                #:FAIL1468))))
                                                                                                       #:FAIL1468
                                                                                                       (RETURN-FROM
                                                                                                        #:BLOCK1467
                                                                                                         (BLOCK
                                                                                                             #:BLOCK1469
                                                                                                           (TAGBODY
                                                                                                              (RETURN-FROM
                                                                                                               #:BLOCK1469
                                                                                                                (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                                                                                                   (GO
                                                                                                                                    #:FAIL1470)))
                                                                                                                  (IF (OPTIMA.CORE:%EQUAL
                                                                                                                       #:G1465
                                                                                                                       "search-result-item__name search-result-item__name_standard_plus")
                                                                                                                      (VALUES)
                                                                                                                      (GO
                                                                                                                       #:FAIL1470))))
                                                                                                              #:FAIL1470
                                                                                                              (RETURN-FROM
                                                                                                               #:BLOCK1469
                                                                                                                (IF (OPTIMA.CORE:%EQUAL
                                                                                                                     #:G1465
                                                                                                                     "search-result-item__name search-result-item__name_premium")
                                                                                                                    (VALUES)
                                                                                                                    (GO
                                                                                                                     #:FAIL1446))))))))
                                                                                                  (IF (NULL
                                                                                                       #:G1466)
                                                                                                      (IF (CONSP
                                                                                                           #:G1460)
                                                                                                          (LET ((#:G1471
                                                                                                                 (CAR
                                                                                                                  #:G1460))
                                                                                                                (#:G1472
                                                                                                                 (CDR
                                                                                                                  #:G1460)))
                                                                                                            (DECLARE
                                                                                                             (IGNORABLE
                                                                                                              #:G1471
                                                                                                              #:G1472))
                                                                                                            (IF (OPTIMA.CORE:%EQUAL
                                                                                                                 #:G1471
                                                                                                                 '("data-qa"
                                                                                                                   "vacancy-serp__vacancy-title"))
                                                                                                                (IF (CONSP
                                                                                                                     #:G1472)
                                                                                                                    (LET ((#:G1473
                                                                                                                           (CAR
                                                                                                                            #:G1472))
                                                                                                                          (#:G1474
                                                                                                                           (CDR
                                                                                                                            #:G1472)))
                                                                                                                      (DECLARE
                                                                                                                       (IGNORABLE
                                                                                                                        #:G1473
                                                                                                                        #:G1474))
                                                                                                                      (IF (CONSP
                                                                                                                           #:G1473)
                                                                                                                          (LET ((#:G1477
                                                                                                                                 (CAR
                                                                                                                                  #:G1473))
                                                                                                                                (#:G1478
                                                                                                                                 (CDR
                                                                                                                                  #:G1473)))
                                                                                                                            (DECLARE
                                                                                                                             (IGNORABLE
                                                                                                                              #:G1477
                                                                                                                              #:G1478))
                                                                                                                            (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                 #:G1477
                                                                                                                                 "href")
                                                                                                                                (IF (CONSP
                                                                                                                                     #:G1478)
                                                                                                                                    (LET ((#:G1479
                                                                                                                                           (CAR
                                                                                                                                            #:G1478))
                                                                                                                                          (#:G1480
                                                                                                                                           (CDR
                                                                                                                                            #:G1478)))
                                                                                                                                      (DECLARE
                                                                                                                                       (IGNORABLE
                                                                                                                                        #:G1479
                                                                                                                                        #:G1480))
                                                                                                                                      (IF (NULL
                                                                                                                                           #:G1480)
                                                                                                                                          (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                               #:G1474
                                                                                                                                               '(("target"
                                                                                                                                                  "_blank")))
                                                                                                                                              (IF (CONSP
                                                                                                                                                   #:G1456)
                                                                                                                                                  (LET ((#:G1481
                                                                                                                                                         (CAR
                                                                                                                                                          #:G1456))
                                                                                                                                                        (#:G1482
                                                                                                                                                         (CDR
                                                                                                                                                          #:G1456)))
                                                                                                                                                    (DECLARE
                                                                                                                                                     (IGNORABLE
                                                                                                                                                      #:G1481
                                                                                                                                                      #:G1482))
                                                                                                                                                    (IF (NULL
                                                                                                                                                         #:G1482)
                                                                                                                                                        (IF (NULL
                                                                                                                                                             #:G1450)
                                                                                                                                                            (LET ((NAME
                                                                                                                                                                   #:G1481))
                                                                                                                                                              (LET ((ID
                                                                                                                                                                     #:G1479))
                                                                                                                                                                (LIST
                                                                                                                                                                 :ID
                                                                                                                                                                 (PARSE-INTEGER
                                                                                                                                                                  (CAR
                                                                                                                                                                   (LAST
                                                                                                                                                                    (SPLIT-SEQUENCE:SPLIT-SEQUENCE
                                                                                                                                                                     #\/
                                                                                                                                                                     ID))))
                                                                                                                                                                 :NAME
                                                                                                                                                                 NAME)))
                                                                                                                                                            (GO
                                                                                                                                                             #:FAIL1446))
                                                                                                                                                        (GO
                                                                                                                                                         #:FAIL1446)))
                                                                                                                                                  (GO
                                                                                                                                                   #:FAIL1446))
                                                                                                                                              (GO
                                                                                                                                               #:FAIL1446))
                                                                                                                                          (GO
                                                                                                                                           #:FAIL1446)))
                                                                                                                                    (GO
                                                                                                                                     #:FAIL1446))
                                                                                                                                (GO
                                                                                                                                 #:FAIL1446)))
                                                                                                                          (GO
                                                                                                                           #:FAIL1446)))
                                                                                                                    (GO
                                                                                                                     #:FAIL1446))
                                                                                                                (GO
                                                                                                                 #:FAIL1446)))
                                                                                                          (GO
                                                                                                           #:FAIL1446))
                                                                                                      (GO
                                                                                                       #:FAIL1446))))
                                                                                              (GO
                                                                                               #:FAIL1446))
                                                                                          (GO
                                                                                           #:FAIL1446)))
                                                                                    (GO
                                                                                     #:FAIL1446)))
                                                                              (GO
                                                                               #:FAIL1446)))
                                                                        (GO
                                                                         #:FAIL1446))
                                                                    (GO #:FAIL1446)))
                                                              (GO #:FAIL1446)))
                                                        (GO #:FAIL1446))
                                                    (GO #:FAIL1446)))
                                              (GO #:FAIL1446))
                                          (GO #:FAIL1446)))
                                    (GO #:FAIL1446))))
                            #:FAIL1446
                            (RETURN-FROM #:BLOCK1445 NIL)))
                       #'MAPCAR))
                  (MAPTREE
                   #'(LAMBDA (#:G1483)
                       (VALUES
                        (BLOCK #:BLOCK1486
                          (TAGBODY
                             (RETURN-FROM #:BLOCK1486
                               (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1487)))
                                 (IF (CONSP #:G1483)
                                     (LET ((#:G1484 (CAR #:G1483))
                                           (#:G1485 (CDR #:G1483)))
                                       (DECLARE (IGNORABLE #:G1484 #:G1485))
                                       (IF (OPTIMA.CORE:%EQUAL #:G1484 "a")
                                           (IF (CONSP #:G1485)
                                               (LET ((#:G1488 (CAR #:G1485))
                                                     (#:G1489 (CDR #:G1485)))
                                                 (DECLARE
                                                  (IGNORABLE #:G1488 #:G1489))
                                                 (IF (CONSP #:G1488)
                                                     (LET ((#:G1492 (CAR #:G1488))
                                                           (#:G1493 (CDR #:G1488)))
                                                       (DECLARE
                                                        (IGNORABLE #:G1492 #:G1493))
                                                       (IF (OPTIMA.CORE:%EQUAL
                                                            #:G1492
                                                            '("class"
                                                              "interview-insider__link                   m-interview-insider__link-searchresult"))
                                                           (IF (CONSP #:G1493)
                                                               (LET ((#:G1494
                                                                      (CAR #:G1493))
                                                                     (#:G1495
                                                                      (CDR #:G1493)))
                                                                 (DECLARE
                                                                  (IGNORABLE #:G1494
                                                                             #:G1495))
                                                                 (IF (CONSP #:G1494)
                                                                     (LET ((#:G1498
                                                                            (CAR
                                                                             #:G1494))
                                                                           (#:G1499
                                                                            (CDR
                                                                             #:G1494)))
                                                                       (DECLARE
                                                                        (IGNORABLE
                                                                         #:G1498
                                                                         #:G1499))
                                                                       (IF (OPTIMA.CORE:%EQUAL
                                                                            #:G1498
                                                                            "href")
                                                                           (IF (CONSP
                                                                                #:G1499)
                                                                               (LET ((#:G1500
                                                                                      (CAR
                                                                                       #:G1499))
                                                                                     (#:G1501
                                                                                      (CDR
                                                                                       #:G1499)))
                                                                                 (DECLARE
                                                                                  (IGNORABLE
                                                                                   #:G1500
                                                                                   #:G1501))
                                                                                 (IF (NULL
                                                                                      #:G1501)
                                                                                     (IF (OPTIMA.CORE:%EQUAL
                                                                                          #:G1495
                                                                                          '(("data-qa"
                                                                                             "vacancy-serp__vacancy-interview-insider")))
                                                                                         (IF (OPTIMA.CORE:%EQUAL
                                                                                              #:G1489
                                                                                              '("Посмотреть интервью о жизни в компании"))
                                                                                             (LET ((HREF
                                                                                                    #:G1500))
                                                                                               (LIST
                                                                                                :INTERVIEW
                                                                                                HREF))
                                                                                             (GO
                                                                                              #:FAIL1487))
                                                                                         (GO
                                                                                          #:FAIL1487))
                                                                                     (GO
                                                                                      #:FAIL1487)))
                                                                               (GO
                                                                                #:FAIL1487))
                                                                           (GO
                                                                            #:FAIL1487)))
                                                                     (GO
                                                                      #:FAIL1487)))
                                                               (GO #:FAIL1487))
                                                           (GO #:FAIL1487)))
                                                     (GO #:FAIL1487)))
                                               (GO #:FAIL1487))
                                           (GO #:FAIL1487)))
                                     (GO #:FAIL1487))))
                             #:FAIL1487
                             (RETURN-FROM #:BLOCK1486 NIL)))
                        #'MAPCAR))
                   (MAPTREE
                    #'(LAMBDA (#:G1502)
                        (VALUES
                         (BLOCK #:BLOCK1505
                           (TAGBODY
                              (RETURN-FROM #:BLOCK1505
                                (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1506)))
                                  (IF (CONSP #:G1502)
                                      (LET ((#:G1503 (CAR #:G1502))
                                            (#:G1504 (CDR #:G1502)))
                                        (DECLARE (IGNORABLE #:G1503 #:G1504))
                                        (IF (OPTIMA.CORE:%EQUAL #:G1503 "div")
                                            (IF (CONSP #:G1504)
                                                (LET ((#:G1507 (CAR #:G1504))
                                                      (#:G1508 (CDR #:G1504)))
                                                  (DECLARE
                                                   (IGNORABLE #:G1507 #:G1508))
                                                  (IF (OPTIMA.CORE:%EQUAL #:G1507
                                                                          '(("class"
                                                                             "b-vacancy-list-salary")
                                                                            ("data-qa"
                                                                             "vacancy-serp__vacancy-compensation")))
                                                      (IF (CONSP #:G1508)
                                                          (LET ((#:G1509
                                                                 (CAR #:G1508))
                                                                (#:G1510
                                                                 (CDR #:G1508)))
                                                            (DECLARE
                                                             (IGNORABLE #:G1509
                                                                        #:G1510))
                                                            (IF (CONSP #:G1509)
                                                                (LET ((#:G1513
                                                                       (CAR #:G1509))
                                                                      (#:G1514
                                                                       (CDR #:G1509)))
                                                                  (DECLARE
                                                                   (IGNORABLE #:G1513
                                                                              #:G1514))
                                                                  (IF (OPTIMA.CORE:%EQUAL
                                                                       #:G1513
                                                                       "meta")
                                                                      (IF (CONSP
                                                                           #:G1514)
                                                                          (LET ((#:G1515
                                                                                 (CAR
                                                                                  #:G1514))
                                                                                (#:G1516
                                                                                 (CDR
                                                                                  #:G1514)))
                                                                            (DECLARE
                                                                             (IGNORABLE
                                                                              #:G1515
                                                                              #:G1516))
                                                                            (IF (CONSP
                                                                                 #:G1515)
                                                                                (LET ((#:G1519
                                                                                       (CAR
                                                                                        #:G1515))
                                                                                      (#:G1520
                                                                                       (CDR
                                                                                        #:G1515)))
                                                                                  (DECLARE
                                                                                   (IGNORABLE
                                                                                    #:G1519
                                                                                    #:G1520))
                                                                                  (IF (OPTIMA.CORE:%EQUAL
                                                                                       #:G1519
                                                                                       '("itemprop"
                                                                                         "salaryCurrency"))
                                                                                      (IF (CONSP
                                                                                           #:G1520)
                                                                                          (LET ((#:G1521
                                                                                                 (CAR
                                                                                                  #:G1520))
                                                                                                (#:G1522
                                                                                                 (CDR
                                                                                                  #:G1520)))
                                                                                            (DECLARE
                                                                                             (IGNORABLE
                                                                                              #:G1521
                                                                                              #:G1522))
                                                                                            (IF (CONSP
                                                                                                 #:G1521)
                                                                                                (LET ((#:G1525
                                                                                                       (CAR
                                                                                                        #:G1521))
                                                                                                      (#:G1526
                                                                                                       (CDR
                                                                                                        #:G1521)))
                                                                                                  (DECLARE
                                                                                                   (IGNORABLE
                                                                                                    #:G1525
                                                                                                    #:G1526))
                                                                                                  (IF (OPTIMA.CORE:%EQUAL
                                                                                                       #:G1525
                                                                                                       "content")
                                                                                                      (IF (CONSP
                                                                                                           #:G1526)
                                                                                                          (LET ((#:G1527
                                                                                                                 (CAR
                                                                                                                  #:G1526))
                                                                                                                (#:G1528
                                                                                                                 (CDR
                                                                                                                  #:G1526)))
                                                                                                            (DECLARE
                                                                                                             (IGNORABLE
                                                                                                              #:G1527
                                                                                                              #:G1528))
                                                                                                            (IF (NULL
                                                                                                                 #:G1528)
                                                                                                                (IF (NULL
                                                                                                                     #:G1522)
                                                                                                                    (IF (NULL
                                                                                                                         #:G1516)
                                                                                                                        (IF (CONSP
                                                                                                                             #:G1510)
                                                                                                                            (LET ((#:G1529
                                                                                                                                   (CAR
                                                                                                                                    #:G1510))
                                                                                                                                  (#:G1530
                                                                                                                                   (CDR
                                                                                                                                    #:G1510)))
                                                                                                                              (DECLARE
                                                                                                                               (IGNORABLE
                                                                                                                                #:G1529
                                                                                                                                #:G1530))
                                                                                                                              (IF (CONSP
                                                                                                                                   #:G1529)
                                                                                                                                  (LET ((#:G1533
                                                                                                                                         (CAR
                                                                                                                                          #:G1529))
                                                                                                                                        (#:G1534
                                                                                                                                         (CDR
                                                                                                                                          #:G1529)))
                                                                                                                                    (DECLARE
                                                                                                                                     (IGNORABLE
                                                                                                                                      #:G1533
                                                                                                                                      #:G1534))
                                                                                                                                    (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                         #:G1533
                                                                                                                                         "meta")
                                                                                                                                        (IF (CONSP
                                                                                                                                             #:G1534)
                                                                                                                                            (LET ((#:G1535
                                                                                                                                                   (CAR
                                                                                                                                                    #:G1534))
                                                                                                                                                  (#:G1536
                                                                                                                                                   (CDR
                                                                                                                                                    #:G1534)))
                                                                                                                                              (DECLARE
                                                                                                                                               (IGNORABLE
                                                                                                                                                #:G1535
                                                                                                                                                #:G1536))
                                                                                                                                              (IF (CONSP
                                                                                                                                                   #:G1535)
                                                                                                                                                  (LET ((#:G1539
                                                                                                                                                         (CAR
                                                                                                                                                          #:G1535))
                                                                                                                                                        (#:G1540
                                                                                                                                                         (CDR
                                                                                                                                                          #:G1535)))
                                                                                                                                                    (DECLARE
                                                                                                                                                     (IGNORABLE
                                                                                                                                                      #:G1539
                                                                                                                                                      #:G1540))
                                                                                                                                                    (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                                         #:G1539
                                                                                                                                                         '("itemprop"
                                                                                                                                                           "baseSalary"))
                                                                                                                                                        (IF (CONSP
                                                                                                                                                             #:G1540)
                                                                                                                                                            (LET ((#:G1541
                                                                                                                                                                   (CAR
                                                                                                                                                                    #:G1540))
                                                                                                                                                                  (#:G1542
                                                                                                                                                                   (CDR
                                                                                                                                                                    #:G1540)))
                                                                                                                                                              (DECLARE
                                                                                                                                                               (IGNORABLE
                                                                                                                                                                #:G1541
                                                                                                                                                                #:G1542))
                                                                                                                                                              (IF (CONSP
                                                                                                                                                                   #:G1541)
                                                                                                                                                                  (LET ((#:G1545
                                                                                                                                                                         (CAR
                                                                                                                                                                          #:G1541))
                                                                                                                                                                        (#:G1546
                                                                                                                                                                         (CDR
                                                                                                                                                                          #:G1541)))
                                                                                                                                                                    (DECLARE
                                                                                                                                                                     (IGNORABLE
                                                                                                                                                                      #:G1545
                                                                                                                                                                      #:G1546))
                                                                                                                                                                    (IF (OPTIMA.CORE:%EQUAL
                                                                                                                                                                         #:G1545
                                                                                                                                                                         "content")
                                                                                                                                                                        (IF (CONSP
                                                                                                                                                                             #:G1546)
                                                                                                                                                                            (LET ((#:G1547
                                                                                                                                                                                   (CAR
                                                                                                                                                                                    #:G1546))
                                                                                                                                                                                  (#:G1548
                                                                                                                                                                                   (CDR
                                                                                                                                                                                    #:G1546)))
                                                                                                                                                                              (DECLARE
                                                                                                                                                                               (IGNORABLE
                                                                                                                                                                                #:G1547
                                                                                                                                                                                #:G1548))
                                                                                                                                                                              (IF (NULL
                                                                                                                                                                                   #:G1548)
                                                                                                                                                                                  (IF (NULL
                                                                                                                                                                                       #:G1542)
                                                                                                                                                                                      (IF (NULL
                                                                                                                                                                                           #:G1536)
                                                                                                                                                                                          (IF (CONSP
                                                                                                                                                                                               #:G1530)
                                                                                                                                                                                              (LET ((#:G1549
                                                                                                                                                                                                     (CAR
                                                                                                                                                                                                      #:G1530))
                                                                                                                                                                                                    (#:G1550
                                                                                                                                                                                                     (CDR
                                                                                                                                                                                                      #:G1530)))
                                                                                                                                                                                                (DECLARE
                                                                                                                                                                                                 (IGNORABLE
                                                                                                                                                                                                  #:G1549
                                                                                                                                                                                                  #:G1550))
                                                                                                                                                                                                (IF (NULL
                                                                                                                                                                                                     #:G1550)
                                                                                                                                                                                                    (LET ((SALARY-TEXT
                                                                                                                                                                                                           #:G1549))
                                                                                                                                                                                                      (LET ((SALARY
                                                                                                                                                                                                             #:G1547))
                                                                                                                                                                                                        (LET ((CURRENCY
                                                                                                                                                                                                               #:G1527))
                                                                                                                                                                                                          (LIST
                                                                                                                                                                                                           :CURRENCY
                                                                                                                                                                                                           CURRENCY
                                                                                                                                                                                                           :SALARY
                                                                                                                                                                                                           (PARSE-INTEGER
                                                                                                                                                                                                            SALARY)
                                                                                                                                                                                                           :SALARY-TEXT
                                                                                                                                                                                                           SALARY-TEXT))))
                                                                                                                                                                                                    (GO
                                                                                                                                                                                                     #:FAIL1506)))
                                                                                                                                                                                              (GO
                                                                                                                                                                                               #:FAIL1506))
                                                                                                                                                                                          (GO
                                                                                                                                                                                           #:FAIL1506))
                                                                                                                                                                                      (GO
                                                                                                                                                                                       #:FAIL1506))
                                                                                                                                                                                  (GO
                                                                                                                                                                                   #:FAIL1506)))
                                                                                                                                                                            (GO
                                                                                                                                                                             #:FAIL1506))
                                                                                                                                                                        (GO
                                                                                                                                                                         #:FAIL1506)))
                                                                                                                                                                  (GO
                                                                                                                                                                   #:FAIL1506)))
                                                                                                                                                            (GO
                                                                                                                                                             #:FAIL1506))
                                                                                                                                                        (GO
                                                                                                                                                         #:FAIL1506)))
                                                                                                                                                  (GO
                                                                                                                                                   #:FAIL1506)))
                                                                                                                                            (GO
                                                                                                                                             #:FAIL1506))
                                                                                                                                        (GO
                                                                                                                                         #:FAIL1506)))
                                                                                                                                  (GO
                                                                                                                                   #:FAIL1506)))
                                                                                                                            (GO
                                                                                                                             #:FAIL1506))
                                                                                                                        (GO
                                                                                                                         #:FAIL1506))
                                                                                                                    (GO
                                                                                                                     #:FAIL1506))
                                                                                                                (GO
                                                                                                                 #:FAIL1506)))
                                                                                                          (GO
                                                                                                           #:FAIL1506))
                                                                                                      (GO
                                                                                                       #:FAIL1506)))
                                                                                                (GO
                                                                                                 #:FAIL1506)))
                                                                                          (GO
                                                                                           #:FAIL1506))
                                                                                      (GO
                                                                                       #:FAIL1506)))
                                                                                (GO
                                                                                 #:FAIL1506)))
                                                                          (GO
                                                                           #:FAIL1506))
                                                                      (GO
                                                                       #:FAIL1506)))
                                                                (GO #:FAIL1506)))
                                                          (GO #:FAIL1506))
                                                      (GO #:FAIL1506)))
                                                (GO #:FAIL1506))
                                            (GO #:FAIL1506)))
                                      (GO #:FAIL1506))))
                              #:FAIL1506
                              (RETURN-FROM #:BLOCK1505 NIL)))
                         #'MAPCAR))
                    (MAPTREE
                     #'(LAMBDA (#:G1551)
                         (VALUES
                          (BLOCK #:BLOCK1554
                            (TAGBODY
                               (RETURN-FROM #:BLOCK1554
                                 (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1555)))
                                   (IF (CONSP #:G1551)
                                       (LET ((#:G1552 (CAR #:G1551))
                                             (#:G1553 (CDR #:G1551)))
                                         (DECLARE (IGNORABLE #:G1552 #:G1553))
                                         (IF (OPTIMA.CORE:%EQUAL #:G1552 "div")
                                             (IF (CONSP #:G1553)
                                                 (LET ((#:G1556 (CAR #:G1553))
                                                       (#:G1557 (CDR #:G1553)))
                                                   (DECLARE
                                                    (IGNORABLE #:G1556 #:G1557))
                                                   (IF (OPTIMA.CORE:%EQUAL #:G1556
                                                                           '(("class"
                                                                              "search-result-item__company")))
                                                       (IF (CONSP #:G1557)
                                                           (LET ((#:G1558
                                                                  (CAR #:G1557))
                                                                 (#:G1559
                                                                  (CDR #:G1557)))
                                                             (DECLARE
                                                              (IGNORABLE #:G1558
                                                                         #:G1559))
                                                             (IF (NULL #:G1559)
                                                                 (LET ((EMP-NAME
                                                                        #:G1558))
                                                                   (LIST :EMP-NAME
                                                                         EMP-NAME))
                                                                 (GO #:FAIL1555)))
                                                           (GO #:FAIL1555))
                                                       (GO #:FAIL1555)))
                                                 (GO #:FAIL1555))
                                             (GO #:FAIL1555)))
                                       (GO #:FAIL1555))))
                               #:FAIL1555
                               (RETURN-FROM #:BLOCK1554 NIL)))
                          #'MAPCAR))
                     (MAPTREE
                      #'(LAMBDA (#:G1560)
                          (VALUES
                           (BLOCK #:BLOCK1563
                             (TAGBODY
                                (RETURN-FROM #:BLOCK1563
                                  (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1564)))
                                    (IF (CONSP #:G1560)
                                        (LET ((#:G1561 (CAR #:G1560))
                                              (#:G1562 (CDR #:G1560)))
                                          (DECLARE (IGNORABLE #:G1561 #:G1562))
                                          (IF (OPTIMA.CORE:%EQUAL #:G1561 "div")
                                              (IF (CONSP #:G1562)
                                                  (LET ((#:G1565 (CAR #:G1562))
                                                        (#:G1566 (CDR #:G1562)))
                                                    (DECLARE
                                                     (IGNORABLE #:G1565 #:G1566))
                                                    (IF (OPTIMA.CORE:%EQUAL #:G1565
                                                                            '(("class"
                                                                               "search-result-item__company")))
                                                        (IF (CONSP #:G1566)
                                                            (LET ((#:G1567
                                                                   (CAR #:G1566))
                                                                  (#:G1568
                                                                   (CDR #:G1566)))
                                                              (DECLARE
                                                               (IGNORABLE #:G1567
                                                                          #:G1568))
                                                              (IF (CONSP #:G1567)
                                                                  (LET ((#:G1571
                                                                         (CAR
                                                                          #:G1567))
                                                                        (#:G1572
                                                                         (CDR
                                                                          #:G1567)))
                                                                    (DECLARE
                                                                     (IGNORABLE
                                                                      #:G1571
                                                                      #:G1572))
                                                                    (IF (OPTIMA.CORE:%EQUAL
                                                                         #:G1571 "a")
                                                                        (IF (CONSP
                                                                             #:G1572)
                                                                            (LET ((#:G1573
                                                                                   (CAR
                                                                                    #:G1572))
                                                                                  (#:G1574
                                                                                   (CDR
                                                                                    #:G1572)))
                                                                              (DECLARE
                                                                               (IGNORABLE
                                                                                #:G1573
                                                                                #:G1574))
                                                                              (IF (CONSP
                                                                                   #:G1573)
                                                                                  (LET ((#:G1577
                                                                                         (CAR
                                                                                          #:G1573))
                                                                                        (#:G1578
                                                                                         (CDR
                                                                                          #:G1573)))
                                                                                    (DECLARE
                                                                                     (IGNORABLE
                                                                                      #:G1577
                                                                                      #:G1578))
                                                                                    (IF (CONSP
                                                                                         #:G1577)
                                                                                        (LET ((#:G1581
                                                                                               (CAR
                                                                                                #:G1577))
                                                                                              (#:G1582
                                                                                               (CDR
                                                                                                #:G1577)))
                                                                                          (DECLARE
                                                                                           (IGNORABLE
                                                                                            #:G1581
                                                                                            #:G1582))
                                                                                          (IF (OPTIMA.CORE:%EQUAL
                                                                                               #:G1581
                                                                                               "href")
                                                                                              (IF (CONSP
                                                                                                   #:G1582)
                                                                                                  (LET ((#:G1583
                                                                                                         (CAR
                                                                                                          #:G1582))
                                                                                                        (#:G1584
                                                                                                         (CDR
                                                                                                          #:G1582)))
                                                                                                    (DECLARE
                                                                                                     (IGNORABLE
                                                                                                      #:G1583
                                                                                                      #:G1584))
                                                                                                    (IF (NULL
                                                                                                         #:G1584)
                                                                                                        (IF (OPTIMA.CORE:%EQUAL
                                                                                                             #:G1578
                                                                                                             '(("class"
                                                                                                                "search-result-item__company-link")
                                                                                                               ("data-qa"
                                                                                                                "vacancy-serp__vacancy-employer")))
                                                                                                            (IF (CONSP
                                                                                                                 #:G1574)
                                                                                                                (LET ((#:G1585
                                                                                                                       (CAR
                                                                                                                        #:G1574))
                                                                                                                      (#:G1586
                                                                                                                       (CDR
                                                                                                                        #:G1574)))
                                                                                                                  (DECLARE
                                                                                                                   (IGNORABLE
                                                                                                                    #:G1585
                                                                                                                    #:G1586))
                                                                                                                  (IF (NULL
                                                                                                                       #:G1586)
                                                                                                                      (IF (NULL
                                                                                                                           #:G1568)
                                                                                                                          (LET ((EMP-NAME
                                                                                                                                 #:G1585))
                                                                                                                            (LET ((EMP-ID
                                                                                                                                   #:G1583))
                                                                                                                              (LIST
                                                                                                                               :EMP-ID
                                                                                                                               (PARSE-INTEGER
                                                                                                                                (CAR
                                                                                                                                 (LAST
                                                                                                                                  (SPLIT-SEQUENCE:SPLIT-SEQUENCE
                                                                                                                                   #\/
                                                                                                                                   EMP-ID)))
                                                                                                                                :JUNK-ALLOWED
                                                                                                                                T)
                                                                                                                               :EMP-NAME
                                                                                                                               EMP-NAME)))
                                                                                                                          (GO
                                                                                                                           #:FAIL1564))
                                                                                                                      (GO
                                                                                                                       #:FAIL1564)))
                                                                                                                (GO
                                                                                                                 #:FAIL1564))
                                                                                                            (GO
                                                                                                             #:FAIL1564))
                                                                                                        (GO
                                                                                                         #:FAIL1564)))
                                                                                                  (GO
                                                                                                   #:FAIL1564))
                                                                                              (GO
                                                                                               #:FAIL1564)))
                                                                                        (GO
                                                                                         #:FAIL1564)))
                                                                                  (GO
                                                                                   #:FAIL1564)))
                                                                            (GO
                                                                             #:FAIL1564))
                                                                        (GO
                                                                         #:FAIL1564)))
                                                                  (GO #:FAIL1564)))
                                                            (GO #:FAIL1564))
                                                        (GO #:FAIL1564)))
                                                  (GO #:FAIL1564))
                                              (GO #:FAIL1564)))
                                        (GO #:FAIL1564))))
                                #:FAIL1564
                                (RETURN-FROM #:BLOCK1563 NIL)))
                           #'MAPCAR))
                      (MAPTREE
                       #'(LAMBDA (#:G1587)
                           (VALUES
                            (BLOCK #:BLOCK1590
                              (TAGBODY
                                 (RETURN-FROM #:BLOCK1590
                                   (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1591)))
                                     (IF (CONSP #:G1587)
                                         (LET ((#:G1588 (CAR #:G1587))
                                               (#:G1589 (CDR #:G1587)))
                                           (DECLARE (IGNORABLE #:G1588 #:G1589))
                                           (IF (OPTIMA.CORE:%EQUAL #:G1588 "div")
                                               (IF (CONSP #:G1589)
                                                   (LET ((#:G1592 (CAR #:G1589))
                                                         (#:G1593 (CDR #:G1589)))
                                                     (DECLARE
                                                      (IGNORABLE #:G1592 #:G1593))
                                                     (IF (OPTIMA.CORE:%EQUAL #:G1592
                                                                             '(("class"
                                                                                "search-result-item__info")))
                                                         (LET ((REST #:G1593))
                                                           (BLOCK NIL
                                                             (LET ((ITEM NIL)
                                                                   (#:LOOP-LIST-1597
                                                                    REST))
                                                               (DECLARE
                                                                (TYPE LIST
                                                                      #:LOOP-LIST-1597))
                                                               (LET* ((#:LOOP-LIST-HEAD-1598
                                                                       (LIST NIL))
                                                                      (#:LOOP-LIST-TAIL-1599
                                                                       #:LOOP-LIST-HEAD-1598))
                                                                 (TAGBODY
                                                                  SB-LOOP::NEXT-LOOP
                                                                    (IF (ENDP
                                                                         #:LOOP-LIST-1597)
                                                                        (PROGN
                                                                          (GO
                                                                           SB-LOOP::END-LOOP))
                                                                        NIL)
                                                                    (SETQ ITEM
                                                                          (CAR
                                                                           #:LOOP-LIST-1597))
                                                                    (SETQ #:LOOP-LIST-1597
                                                                          (CDR
                                                                           #:LOOP-LIST-1597))
                                                                    (IF (CONSP ITEM)
                                                                        (IF (SB-KERNEL:%RPLACD
                                                                             #:LOOP-LIST-TAIL-1599
                                                                             (COPY-LIST
                                                                              ITEM))
                                                                            (PROGN
                                                                              (SETQ #:LOOP-LIST-TAIL-1599
                                                                                    (LAST
                                                                                     (CDR
                                                                                      #:LOOP-LIST-TAIL-1599))))
                                                                            NIL))
                                                                    (GO
                                                                     SB-LOOP::NEXT-LOOP)
                                                                  SB-LOOP::END-LOOP
                                                                    (RETURN-FROM NIL
                                                                      (CDR
                                                                       #:LOOP-LIST-HEAD-1598)))))))
                                                         (GO #:FAIL1591)))
                                                   (GO #:FAIL1591))
                                               (GO #:FAIL1591)))
                                         (GO #:FAIL1591))))
                                 #:FAIL1591
                                 (RETURN-FROM #:BLOCK1590 NIL)))
                            #'MAPCAR))
                       (MAPTREE
                        #'(LAMBDA (#:G1602)
                            (VALUES
                             (BLOCK #:BLOCK1605
                               (TAGBODY
                                  (RETURN-FROM #:BLOCK1605
                                    (SYMBOL-MACROLET ((OPTIMA::%FAIL (GO #:FAIL1606)))
                                      (IF (CONSP #:G1602)
                                          (LET ((#:G1603 (CAR #:G1602))
                                                (#:G1604 (CDR #:G1602)))
                                            (DECLARE (IGNORABLE #:G1603 #:G1604))
                                            (IF (OPTIMA.CORE:%EQUAL #:G1603 "span")
                                                (IF (CONSP #:G1604)
                                                    (LET ((#:G1607 (CAR #:G1604))
                                                          (#:G1608 (CDR #:G1604)))
                                                      (DECLARE
                                                       (IGNORABLE #:G1607 #:G1608))
                                                      (IF (OPTIMA.CORE:%EQUAL #:G1607
                                                                              '(("class"
                                                                                 "searchresult__address")
                                                                                ("data-qa"
                                                                                 "vacancy-serp__vacancy-address")))
                                                          (IF (CONSP #:G1608)
                                                              (LET ((#:G1609
                                                                     (CAR #:G1608))
                                                                    (#:G1610
                                                                     (CDR #:G1608)))
                                                                (DECLARE
                                                                 (IGNORABLE #:G1609
                                                                            #:G1610))
                                                                (LET ((REST #:G1610))
                                                                  (LET ((CITY
                                                                         #:G1609))
                                                                    (LET ((METRO
                                                                           (BLOCK NIL
                                                                             (LET ((ITEM
                                                                                    NIL)
                                                                                   (#:LOOP-LIST-1611
                                                                                    REST))
                                                                               (DECLARE
                                                                                (TYPE
                                                                                 LIST
                                                                                 #:LOOP-LIST-1611))
                                                                               (TAGBODY
                                                                                SB-LOOP::NEXT-LOOP
                                                                                  (IF (ENDP
                                                                                       #:LOOP-LIST-1611)
                                                                                      (PROGN
                                                                                        (GO
                                                                                         SB-LOOP::END-LOOP))
                                                                                      NIL)
                                                                                  (SETQ ITEM
                                                                                        (CAR
                                                                                         #:LOOP-LIST-1611))
                                                                                  (SETQ #:LOOP-LIST-1611
                                                                                        (CDR
                                                                                         #:LOOP-LIST-1611))
                                                                                  (IF (IF (CONSP
                                                                                           ITEM)
                                                                                          (THE
                                                                                           T
                                                                                           (EQUAL
                                                                                            :METRO
                                                                                            (CAR
                                                                                             ITEM)))
                                                                                          NIL)
                                                                                      (PROGN
                                                                                        (RETURN-FROM
                                                                                         NIL
                                                                                          (CADR
                                                                                           ITEM)))
                                                                                      NIL)
                                                                                  (GO
                                                                                   SB-LOOP::NEXT-LOOP)
                                                                                SB-LOOP::END-LOOP)))))
                                                                      (LIST :CITY
                                                                            CITY
                                                                            :METRO
                                                                            METRO)))))
                                                              (GO #:FAIL1606))
                                                          (GO #:FAIL1606)))
                                                    (GO #:FAIL1606))
                                                (GO #:FAIL1606)))
                                          (GO #:FAIL1606))))
                                  #:FAIL1606
                                  (RETURN-FROM #:BLOCK1605 NIL)))
                             #'MAPCAR))
                        (MAPTREE
                         #'(LAMBDA (#:G1612)
                             (VALUES
                              (BLOCK #:BLOCK1615
                                (TAGBODY
                                   (RETURN-FROM #:BLOCK1615
                                     (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                        (GO #:FAIL1616)))
                                       (IF (CONSP #:G1612)
                                           (LET ((#:G1613 (CAR #:G1612))
                                                 (#:G1614 (CDR #:G1612)))
                                             (DECLARE (IGNORABLE #:G1613 #:G1614))
                                             (IF (OPTIMA.CORE:%EQUAL #:G1613 "span")
                                                 (IF (CONSP #:G1614)
                                                     (LET ((#:G1617 (CAR #:G1614))
                                                           (#:G1618 (CDR #:G1614)))
                                                       (DECLARE
                                                        (IGNORABLE #:G1617 #:G1618))
                                                       (IF (OPTIMA.CORE:%EQUAL
                                                            #:G1617
                                                            '(("class"
                                                               "metro-station")))
                                                           (IF (CONSP #:G1618)
                                                               (LET ((#:G1619
                                                                      (CAR #:G1618))
                                                                     (#:G1620
                                                                      (CDR #:G1618)))
                                                                 (DECLARE
                                                                  (IGNORABLE #:G1619
                                                                             #:G1620))
                                                                 (IF (CONSP #:G1619)
                                                                     (LET ((#:G1623
                                                                            (CAR
                                                                             #:G1619))
                                                                           (#:G1624
                                                                            (CDR
                                                                             #:G1619)))
                                                                       (DECLARE
                                                                        (IGNORABLE
                                                                         #:G1623
                                                                         #:G1624))
                                                                       (IF (OPTIMA.CORE:%EQUAL
                                                                            #:G1623
                                                                            "span")
                                                                           (IF (CONSP
                                                                                #:G1624)
                                                                               (LET ((#:G1625
                                                                                      (CAR
                                                                                       #:G1624))
                                                                                     (#:G1626
                                                                                      (CDR
                                                                                       #:G1624)))
                                                                                 (DECLARE
                                                                                  (IGNORABLE
                                                                                   #:G1625
                                                                                   #:G1626))
                                                                                 (IF (CONSP
                                                                                      #:G1625)
                                                                                     (LET ((#:G1629
                                                                                            (CAR
                                                                                             #:G1625))
                                                                                           (#:G1630
                                                                                            (CDR
                                                                                             #:G1625)))
                                                                                       (DECLARE
                                                                                        (IGNORABLE
                                                                                         #:G1629
                                                                                         #:G1630))
                                                                                       (IF (OPTIMA.CORE:%EQUAL
                                                                                            #:G1629
                                                                                            '("class"
                                                                                              "metro-point"))
                                                                                           (IF (CONSP
                                                                                                #:G1630)
                                                                                               (LET ((#:G1631
                                                                                                      (CAR
                                                                                                       #:G1630))
                                                                                                     (#:G1632
                                                                                                      (CDR
                                                                                                       #:G1630)))
                                                                                                 (DECLARE
                                                                                                  (IGNORABLE
                                                                                                   #:G1631
                                                                                                   #:G1632))
                                                                                                 (IF (CONSP
                                                                                                      #:G1631)
                                                                                                     (LET ((#:G1635
                                                                                                            (CAR
                                                                                                             #:G1631))
                                                                                                           (#:G1636
                                                                                                            (CDR
                                                                                                             #:G1631)))
                                                                                                       (DECLARE
                                                                                                        (IGNORABLE
                                                                                                         #:G1635
                                                                                                         #:G1636))
                                                                                                       (IF (OPTIMA.CORE:%EQUAL
                                                                                                            #:G1635
                                                                                                            "style")
                                                                                                           (IF (CONSP
                                                                                                                #:G1636)
                                                                                                               (LET ((#:G1637
                                                                                                                      (CAR
                                                                                                                       #:G1636))
                                                                                                                     (#:G1638
                                                                                                                      (CDR
                                                                                                                       #:G1636)))
                                                                                                                 (DECLARE
                                                                                                                  (IGNORABLE
                                                                                                                   #:G1637
                                                                                                                   #:G1638))
                                                                                                                 (IF (NULL
                                                                                                                      #:G1638)
                                                                                                                     (IF (NULL
                                                                                                                          #:G1632)
                                                                                                                         (IF (NULL
                                                                                                                              #:G1626)
                                                                                                                             (IF (CONSP
                                                                                                                                  #:G1620)
                                                                                                                                 (LET ((#:G1639
                                                                                                                                        (CAR
                                                                                                                                         #:G1620))
                                                                                                                                       (#:G1640
                                                                                                                                        (CDR
                                                                                                                                         #:G1620)))
                                                                                                                                   (DECLARE
                                                                                                                                    (IGNORABLE
                                                                                                                                     #:G1639
                                                                                                                                     #:G1640))
                                                                                                                                   (IF (NULL
                                                                                                                                        #:G1640)
                                                                                                                                       (LET ((METRO
                                                                                                                                              #:G1639))
                                                                                                                                         (LIST
                                                                                                                                          :METRO
                                                                                                                                          METRO))
                                                                                                                                       (GO
                                                                                                                                        #:FAIL1616)))
                                                                                                                                 (GO
                                                                                                                                  #:FAIL1616))
                                                                                                                             (GO
                                                                                                                              #:FAIL1616))
                                                                                                                         (GO
                                                                                                                          #:FAIL1616))
                                                                                                                     (GO
                                                                                                                      #:FAIL1616)))
                                                                                                               (GO
                                                                                                                #:FAIL1616))
                                                                                                           (GO
                                                                                                            #:FAIL1616)))
                                                                                                     (GO
                                                                                                      #:FAIL1616)))
                                                                                               (GO
                                                                                                #:FAIL1616))
                                                                                           (GO
                                                                                            #:FAIL1616)))
                                                                                     (GO
                                                                                      #:FAIL1616)))
                                                                               (GO
                                                                                #:FAIL1616))
                                                                           (GO
                                                                            #:FAIL1616)))
                                                                     (GO
                                                                      #:FAIL1616)))
                                                               (GO #:FAIL1616))
                                                           (GO #:FAIL1616)))
                                                     (GO #:FAIL1616))
                                                 (GO #:FAIL1616)))
                                           (GO #:FAIL1616))))
                                   #:FAIL1616
                                   (RETURN-FROM #:BLOCK1615 NIL)))
                              #'MAPCAR))
                         (MAPTREE
                          #'(LAMBDA (#:G1641)
                              (VALUES
                               (BLOCK #:BLOCK1644
                                 (TAGBODY
                                    (RETURN-FROM #:BLOCK1644
                                      (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                         (GO #:FAIL1645)))
                                        (IF (CONSP #:G1641)
                                            (LET ((#:G1642 (CAR #:G1641))
                                                  (#:G1643 (CDR #:G1641)))
                                              (DECLARE (IGNORABLE #:G1642 #:G1643))
                                              (IF (OPTIMA.CORE:%EQUAL #:G1642 "span")
                                                  (IF (CONSP #:G1643)
                                                      (LET ((#:G1646 (CAR #:G1643))
                                                            (#:G1647 (CDR #:G1643)))
                                                        (DECLARE
                                                         (IGNORABLE #:G1646 #:G1647))
                                                        (IF (OPTIMA.CORE:%EQUAL
                                                             #:G1646
                                                             '(("class"
                                                                "b-vacancy-list-date")
                                                               ("data-qa"
                                                                "vacancy-serp__vacancy-date")))
                                                            (IF (CONSP #:G1647)
                                                                (LET ((#:G1648
                                                                       (CAR #:G1647))
                                                                      (#:G1649
                                                                       (CDR #:G1647)))
                                                                  (DECLARE
                                                                   (IGNORABLE #:G1648
                                                                              #:G1649))
                                                                  (IF (NULL #:G1649)
                                                                      (LET ((DATE
                                                                             #:G1648))
                                                                        (LIST :DATE
                                                                              DATE))
                                                                      (GO
                                                                       #:FAIL1645)))
                                                                (GO #:FAIL1645))
                                                            (GO #:FAIL1645)))
                                                      (GO #:FAIL1645))
                                                  (GO #:FAIL1645)))
                                            (GO #:FAIL1645))))
                                    #:FAIL1645
                                    (RETURN-FROM #:BLOCK1644 NIL)))
                               #'MAPCAR))
                          (MAPTREE
                           #'(LAMBDA (#:G1650)
                               (VALUES
                                (BLOCK #:BLOCK1651
                                  (TAGBODY
                                     (RETURN-FROM #:BLOCK1651
                                       (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                          (GO #:FAIL1652)))
                                         (IF (OPTIMA.CORE:%EQUAL #:G1650
                                                                 '("span"
                                                                   (("class"
                                                                     "vacancy-list-platform")
                                                                    ("data-qa"
                                                                     "vacancy-serp__vacancy_career"))
                                                                   "  •  "
                                                                   ("span"
                                                                    (("class"
                                                                      "vacancy-list-platform__name"))
                                                                    "CAREER.RU")))
                                             (LIST :PLATFORM 'CAREER.RU)
                                             (GO #:FAIL1652))))
                                     #:FAIL1652
                                     (RETURN-FROM #:BLOCK1651 NIL)))
                                #'MAPCAR))
                           (BLOCK SUBTREE-EXTRACT
                             (MAPTREE
                              #'(LAMBDA (#:G1653)
                                  (VALUES
                                   (BLOCK #:BLOCK1656
                                     (TAGBODY
                                        (RETURN-FROM #:BLOCK1656
                                          (SYMBOL-MACROLET ((OPTIMA::%FAIL
                                                             (GO #:FAIL1657)))
                                            (IF (CONSP #:G1653)
                                                (LET ((#:G1654 (CAR #:G1653))
                                                      (#:G1655 (CDR #:G1653)))
                                                  (DECLARE
                                                   (IGNORABLE #:G1654 #:G1655))
                                                  (IF (OPTIMA.CORE:%EQUAL #:G1654
                                                                          "div")
                                                      (IF (CONSP #:G1655)
                                                          (LET ((#:G1658
                                                                 (CAR #:G1655))
                                                                (#:G1659
                                                                 (CDR #:G1655)))
                                                            (DECLARE
                                                             (IGNORABLE #:G1658
                                                                        #:G1659))
                                                            (IF (OPTIMA.CORE:%EQUAL
                                                                 #:G1658
                                                                 '(("class"
                                                                    "search-result")
                                                                   ("data-qa"
                                                                    "vacancy-serp__results")))
                                                                (LET ((REST #:G1659))
                                                                  (RETURN-FROM
                                                                   SUBTREE-EXTRACT
                                                                    REST))
                                                                (GO #:FAIL1657)))
                                                          (GO #:FAIL1657))
                                                      (GO #:FAIL1657)))
                                                (GO #:FAIL1657))))
                                        #:FAIL1657
                                        (RETURN-FROM #:BLOCK1656 NIL)))
                                   #'MAPCAR))
                              ""))))))))))))))))))))))))
   #+END_SRC

** Макроc пишет код - раскрываем факториал

   #+BEGIN_SRC lisp
     (defmacro !1 (x)
       (if (= x 1)
           1
           `(* ,x (!1 ,(1- x)))))

     (macroexpand-all '(!1 5))

     (SB-CLTL2:MACROEXPAND-ALL '(!1 5))

     => (* 5 (* 4 (* 3 (* 2 1))))
   #+END_SRC

** We need to go deeeeeper - макросы, которые определяют макросы

   #+BEGIN_SRC lisp
     (defmacro defsynonym (old-name new-name)
       "Define OLD-NAME to be equivalent to NEW-NAME when used in the first position of a Lisp form."
       `(defmacro, new-name (&rest args)
          `(,',old-name ,@args)))
     => DEFSYNONYM

     (macroexpand-1 '
      (defsynonym cons make-pair))
     =>(DEFMACRO MAKE-PAIR (&REST ARGS) `(CONS ,@ARGS)), T

     (defsynonym cons make-pair)
     =>MAKE-PAIR

     (make-pair 'a 'b)
     => (A . B)
   #+END_SRC

* TODO Что если делать то же самое, но не обязательно до компиляции.

  Когда можно раскрывать макросы - read-time, compile-time,
  load-time. Что такое eval-when и какую пользу оно может нанести

* TODO Специальные макросы чтения
* TODO Практичекская применимость - Оптимизация кода на лету
  (по swizard-у - http://swizard.info/articles/solitaire/article.html)

  Note(Mary): Не со всем согласна. Например, очень странная
  мысль: "Действительно, какая разница: будет проект
  компилироваться десять секунд или десять минут?" - он явно
  не занимался интенсивной разработкой.

  Note(Rigidus): А проект не должен вообще компилироваться - он должен
  разрабатываться в репле. All compilation must be incremental!

  Q(Mary): А где именно там пример оптимизации кода на лету?

  A(Rigidus): А тут пока [TODO]
* В продолжение предыдущего - создание DSL на макросах
  Note(Mary): Если ты хочешь на базе статьи рассказывать про
  DSL, то не рекомендую, там слишком долго объяснять
  придётся, либо никто ничего не поймёт.

  R: Да, но рассказать то надо..
* Немного о гигиене и анафорических макросах

  Идея гигиены - отделить окружение макроса от окружения его
  продукции, и таким образом избежать возможных пересечений
  определяемых переменных.

  В Scheme эта идея прижиалась, но она мешает анафорическим макросам

  Самый простой пример анафорического макроса: АIF (или IF-IT),
  который тестирует первый аргумент на истинность и одновременно
  привязывает его значение к переменной IT, которую, соответственно,
  можно использовать в THEN-clause:

  #+BEGIN_SRC lisp
    (defmacro aif (var then &optional else)
      `(let ((it ,var))
        (if it ,then ,else)))
  #+END_SRC

  Однако на самом деле и в Scheme не так уж сложно добиться
  аналогичных макросов
  (см. http://www.greghendershott.com/fear-of-macros/Syntax_parameters.html).
  Ключевое отличие в том, что в Scheme макросы по умолчанию
  гигиеничны (но гигиену можно обойти, если очень хочется),
  а в Lisp - нет.

  Да, но тут метод добивания совершенно иной! И весь процесс
  добивания - это какой-то костыль "получите те же результаты, но
  контринтуитивно".

** Как сделать гигиену в Lisp

   Использование (gensym)

   #+BEGIN_SRC lisp
     (defmacro swap (pl1 pl2)
       "Macro to swap two places"
       (let ((temp1-name (gensym))
             (temp2-name (gensym)))
         `(let ((,temp1-name ,pl1)
                (,temp2-name ,pl2))
            (setf ,pl1 ,temp2-name)
            (setf ,pl2 ,temp1-name))))

     (defparameter *var1* 123)
     (defparameter *var2* 456)

     (swap *var1* *var2*)

     ,*var1*
     =>456

     ,*var1*
     =>123
   #+END_SRC

* TODO Как нам вооружившись макросами исправить мир?
  Или немного о том, как плохие люди, собрались вместе и испортили
  интернет :) По материалам статьи http://habrahabr.ru/post/269565/ и
  того факта, что javascript раньше был схемой
* TODO Программа, которая меняет саму себя - mutation engine на макросах
  (не уверен осилю ли я это и осилит ли это кто-нибудь понять)

  Q(Mary): а есть ли пример того, когда это действительно нужно?

  Честно говоря - нет. Но если ты пишешь "Самоходное программное
  обеспечение" - то это может пригодиться... Или вот пример - анализ
  обфусцированного кода, или автоматическое написание
  виртуализированной среды по коду-источнику - все, в общем, весьма
  специфичные идеи :)
* Макросы в других языках и сравнение подходов

  (галопом, без погружения)

*** Scheme/Racket
    Note(Mary): ИМХО, нет смысла их различать, второе - прямой
    потомок первого.
    Окей :)
*** Nemerle
*** Scala
*** Dylan

* Нетрадиционно ориентированное программирование:
*** Инструментированный код
*** Jптимизация черного ящика,
*** исполняемые спецификации
*** Динамическое программирование на макросах (swizard)
* Ссылки
  http://swizard.info/articles/functional-data-structures.html
  http://swizard.livejournal.com/157521.html
  http://habrahabr.ru/post/143490/
  http://fprog.ru/2010/issue5/vsevolod-dyomkin-lisp-philosophy/
  http://rus-linux.net/MyLDP/algol/LISP/lisp09.html
  http://lisp2d.net/rus/teach/q.php
  http://cyberleninka.ru/article/n/analiz-vozmozhnostey-sistemy-makroopredeleniy-yazyka-common-lisp-dlya-sozdaniya-novyh-upravlyayuschih-konstruktsiy
  https://books.google.ru/books?id=jaoDX9-e_McC&pg=PA738&lpg=PA738&dq=%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80+%D0%BC%D0%B0%D0%BA%D1%80%D0%BE%D1%81+%D0%BB%D0%B8%D1%81%D0%BF&source=bl&ots=lHfSI5iKbj&sig=sLvsICw1e7p9ehee3zMpKHqT6Kk&hl=ru&sa=X&ved=0CFkQ6AEwCTgUahUKEwidzOn12eDIAhXK_3IKHdliDm8#v=onepage&q=%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BC%D0%B0%D0%BA%D1%80%D0%BE%D1%81%20%D0%BB%D0%B8%D1%81%D0%BF&f=false
  http://linux.yaroslavl.ru/docs/prog/m4.html
